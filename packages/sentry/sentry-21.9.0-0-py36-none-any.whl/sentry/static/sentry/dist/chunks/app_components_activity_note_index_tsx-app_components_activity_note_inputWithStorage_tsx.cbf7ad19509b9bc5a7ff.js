"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_components_activity_note_index_tsx-app_components_activity_note_inputWithStorage_tsx"],{"./app/components/activity/note/index.tsx":(e,t,n)=>{n.d(t,{Z:()=>k});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),r=n("./app/components/activity/item/index.tsx"),a=n("./app/styles/space.tsx"),d=n("./app/utils/marked.tsx"),l=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const p=({className:e,text:t})=>(0,l.tZ)("div",{className:e,"data-test-id":"activity-note-body",dangerouslySetInnerHTML:{__html:(0,d.Z)(t)}});p.displayName="NoteBody";const c=p,m=(0,o.Z)("span",{target:"el2wm7k0"})({name:"eivff4",styles:"display:none"});var h=n("./app/components/activity/author.tsx"),u=n("./app/components/links/linkWithConfirmation.tsx"),g=n("./app/components/tooltip.tsx"),x=n("./app/locale.tsx"),b=n("./app/stores/configStore.tsx");const Z=({authorName:e,user:t,onEdit:n,onDelete:s})=>{const o=b.Z.get("user"),i=o&&(o.isSuperuser||t.id===o.id);return(0,l.BX)("div",{children:[(0,l.tZ)(h.Z,{children:e}),i&&(0,l.BX)(m,{children:[(0,l.tZ)(g.Z,{title:(0,x.t)("You can edit this comment due to your superuser status"),disabled:!o.isSuperuser,children:(0,l.tZ)(y,{onClick:n,children:(0,x.t)("Edit")})}),(0,l.tZ)(g.Z,{title:(0,x.t)("You can delete this comment due to your superuser status"),disabled:!o.isSuperuser,children:(0,l.tZ)(u.Z,{title:(0,x.t)("Remove"),message:(0,x.t)("Are you sure you wish to delete this comment?"),onConfirm:s,children:(0,l.tZ)(v,{children:(0,x.t)("Remove")})})})]})]})};Z.displayName="NoteHeader";const f=e=>"\n  padding: 0 7px;\n  color: ".concat(e.theme.gray200,";\n  font-weight: normal;\n"),y=(0,o.Z)("a",{target:"e1u67hq51"})(f,";margin-left:7px;&:hover{color:",(e=>e.theme.gray300),";}"),v=(0,o.Z)("span",{target:"e1u67hq50"})(f,";border-left:1px solid ",(e=>e.theme.border),";&:hover{color:",(e=>e.theme.error),";}"),w=Z;var C=n("./app/components/activity/note/input.tsx");class j extends i.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{editing:!1}),(0,s.Z)(this,"handleEdit",(()=>{this.setState({editing:!0})})),(0,s.Z)(this,"handleEditFinish",(()=>{this.setState({editing:!1})})),(0,s.Z)(this,"handleDelete",(()=>{const{onDelete:e}=this.props;e(this.props)})),(0,s.Z)(this,"handleCreate",(e=>{const{onCreate:t}=this.props;t&&t(e)})),(0,s.Z)(this,"handleUpdate",(e=>{const{onUpdate:t}=this.props;t(e,this.props),this.setState({editing:!1})}))}render(){const{modelId:e,user:t,dateCreated:n,text:s,authorName:o,hideDate:i,minHeight:r,showTime:a,projectSlugs:d}=this.props,p={hideDate:i,showTime:a,id:"activity-item-".concat(e),author:{type:"user",user:t},date:n};return this.state.editing?(0,l.tZ)(S,{...p,children:()=>(0,l.tZ)(C.Z,{modelId:e,minHeight:r,text:s,onEditFinish:this.handleEditFinish,onUpdate:this.handleUpdate,onCreate:this.handleCreate,projectSlugs:d})}):(0,l.tZ)(_,{...p,header:(0,l.tZ)(w,{authorName:o,user:t,onEdit:this.handleEdit,onDelete:this.handleDelete}),children:(0,l.tZ)(c,{text:s})})}}j.displayName="Note";const S=(0,o.Z)(r.Z,{target:"e1hfgqls1"})("ul{list-style:disc;}h1,h2,h3,h4,p,ul:not(.nav),ol,pre,hr,blockquote{margin-bottom:",(0,a.Z)(2),";}ul:not(.nav),ol{padding-left:20px;}p{a{word-wrap:break-word;}}blockquote{font-size:15px;background:",(e=>e.theme.gray200),";p:last-child{margin-bottom:0;}}"),_=(0,o.Z)(S,{target:"e1hfgqls0"})("&:hover{",m,"{display:inline-block;}}"),k=j},"./app/components/activity/note/input.tsx":(e,t,n)=>{n.d(t,{Z:()=>z});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/react/index.js")),r=n("../node_modules/react-mentions/dist/react-mentions.esm.js"),a=n("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),d=n("./app/components/button.tsx"),l=n("./app/components/navTabs.tsx"),p=n("./app/icons/index.tsx"),c=n("./app/locale.tsx"),m=n("./app/stores/configStore.tsx"),h=n("./app/styles/space.tsx"),u=n("./app/styles/text.tsx"),g=n("./app/utils/marked.tsx"),x=n("../node_modules/lodash/uniqBy.js"),b=n.n(x),Z=n("./app/stores/memberListStore.tsx"),f=n("./app/utils/callIfFunction.tsx"),y=n("./app/utils/isRenderFunc.tsx"),v=n("./app/utils/projects.tsx"),w=n("./app/utils/withOrganization.tsx"),C=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class j extends i.PureComponent{constructor(...e){super(...e),(0,s.Z)(this,"state",{members:Z.Z.getAll()}),(0,s.Z)(this,"listeners",[Z.Z.listen((e=>{this.handleMemberListUpdate(e)}),void 0)]),(0,s.Z)(this,"handleMemberListUpdate",(e=>{e!==this.state.members&&this.setState({members:e})})),(0,s.Z)(this,"renderChildren",(({projects:e})=>{const{children:t,me:n}=this.props;return(0,y.l)(t)?t({members:this.getMemberList(this.state.members,n),teams:this.getTeams(e)}):null}))}componentWillUnmount(){this.listeners.forEach(f.g)}getMemberList(e,t){return b()(e,(({id:e})=>e)).filter((({id:e})=>!t||t.id!==e)).map((e=>{return{id:(t=e.id,"user:".concat(t)),display:e.name,email:e.email};var t}))}getTeams(e){return b()(e.map((({teams:e})=>e)).reduce(((e,t)=>e.concat(t||[])),[]),"id").map((e=>{return{id:(t=e.id,"team:".concat(t)),display:"#".concat(e.slug),email:e.id};var t}))}render(){const{organization:e,projectSlugs:t}=this.props;return t&&t.length?(0,C.tZ)(v.Z,{slugs:t,orgId:e.slug,children:this.renderChildren}):this.renderChildren({projects:[]})}}j.displayName="Mentionables";const S=(0,w.Z)(j);function _({theme:e,minHeight:t}){return{control:{backgroundColor:"".concat(e.background),fontSize:15,fontWeight:"normal"},input:{margin:0},"&singleLine":{control:{display:"inline-block",width:130},highlighter:{padding:1,border:"2px inset transparent"},input:{padding:1,border:"2px inset"}},"&multiLine":{control:{fontFamily:"Rubik, Avenir Next, Helvetica Neue, sans-serif",minHeight:t},highlighter:{padding:20,minHeight:t},input:{padding:"".concat((0,h.Z)(1.5)," ").concat((0,h.Z)(2)," 0"),minHeight:t,overflow:"auto",outline:0,border:0}},suggestions:{list:{maxHeight:150,overflow:"auto",backgroundColor:"".concat(e.background),border:"1px solid rgba(0,0,0,0.15)",fontSize:12},item:{padding:"5px 15px",borderBottom:"1px solid rgba(0,0,0,0.15)","&focused":{backgroundColor:"".concat(e.backgroundSecondary)}}}}}const k={placeholder:(0,c.t)("Add a comment.\nTag users with @, or teams with #"),minHeight:140,busy:!1};class N extends i.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{preview:!1,value:this.props.text||"",memberMentions:[],teamMentions:[]}),(0,s.Z)(this,"handleToggleEdit",(()=>{this.setState({preview:!1})})),(0,s.Z)(this,"handleTogglePreview",(()=>{this.setState({preview:!0})})),(0,s.Z)(this,"handleSubmit",(e=>{e.preventDefault(),this.submitForm()})),(0,s.Z)(this,"handleChange",(e=>{this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e,{updating:!!this.props.modelId})})),(0,s.Z)(this,"handleKeyDown",(e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&this.submitForm()})),(0,s.Z)(this,"handleCancel",(e=>{e.preventDefault(),this.finish()})),(0,s.Z)(this,"handleAddMember",((e,t)=>{this.setState((({memberMentions:n})=>({memberMentions:[...n,["".concat(e),t]]})))})),(0,s.Z)(this,"handleAddTeam",((e,t)=>{this.setState((({teamMentions:n})=>({teamMentions:[...n,["".concat(e),t]]})))}))}cleanMarkdown(e){return e.replace(/\[sentry\.strip:member\]/g,"@").replace(/\[sentry\.strip:team\]/g,"")}submitForm(){this.props.modelId?this.update():this.create()}create(){const{onCreate:e}=this.props;e&&e({text:this.cleanMarkdown(this.state.value),mentions:this.finalizeMentions()})}update(){const{onUpdate:e}=this.props;e&&e({text:this.cleanMarkdown(this.state.value),mentions:this.finalizeMentions()})}finish(){this.props.onEditFinish&&this.props.onEditFinish()}finalizeMentions(){const{memberMentions:e,teamMentions:t}=this.state;return[...e,...t].filter((e=>-1!==this.state.value.indexOf(e[1]))).map((e=>e[0]))}render(){const{preview:e,value:t}=this.state,{modelId:n,busy:s,placeholder:o,minHeight:i,errorJSON:a,memberList:d,teams:l,theme:m}=this.props,h=!!n,u=h?(0,c.t)("Save Comment"):(0,c.t)("Post Comment"),x=a&&("string"==typeof a.detail?a.detail:a.detail&&a.detail.message||(0,c.t)("Unable to post comment"))||null;return(0,C.BX)(E,{"data-test-id":"note-input-form",noValidate:!0,onSubmit:this.handleSubmit,children:[(0,C.BX)(P,{children:[(0,C.tZ)(A,{className:e?"":"active",children:(0,C.tZ)(B,{onClick:this.handleToggleEdit,children:h?(0,c.t)("Edit"):(0,c.t)("Write")})}),(0,C.tZ)(A,{className:e?"active":"",children:(0,C.tZ)(B,{onClick:this.handleTogglePreview,children:(0,c.t)("Preview")})}),(0,C.BX)(D,{children:[(0,C.tZ)(p.kh,{}),(0,C.tZ)(K,{children:(0,c.t)("Markdown supported")})]})]}),(0,C.tZ)(I,{children:e?(0,C.tZ)(O,{minHeight:i,dangerouslySetInnerHTML:{__html:(0,g.Z)(this.cleanMarkdown(t))}}):(0,C.BX)(r.r,{style:_({theme:m,minHeight:i}),placeholder:o,onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:t,required:!0,autoFocus:!0,children:[(0,C.tZ)(r.p,{trigger:"@",data:d,onAdd:this.handleAddMember,displayTransform:(e,t)=>"@".concat(t),markup:"**[sentry.strip:member]__display__**",appendSpaceOnAdd:!0}),(0,C.tZ)(r.p,{trigger:"#",data:l,onAdd:this.handleAddTeam,markup:"**[sentry.strip:team]__display__**",appendSpaceOnAdd:!0})]})}),(0,C.BX)(F,{children:[(0,C.tZ)("div",{children:x&&(0,C.tZ)(L,{children:x})}),(0,C.BX)("div",{children:[h&&(0,C.tZ)(H,{priority:"danger",type:"button",onClick:this.handleCancel,children:(0,c.t)("Cancel")}),(0,C.tZ)(H,{error:x,type:"submit",disabled:s,children:u})]})]})]})}}N.displayName="NoteInputComponent";const M=(0,a.b)(N);class T extends i.Component{constructor(...e){super(...e),(0,s.Z)(this,"renderInput",(({members:e,teams:t})=>{const{projectSlugs:n,...s}=this.props;return(0,C.tZ)(M,{memberList:e,teams:t,...s})}))}render(){const{projectSlugs:e}=this.props,t=m.Z.get("user");return(0,C.tZ)(S,{me:t,projectSlugs:e,children:this.renderInput})}}T.displayName="NoteInputContainer",(0,s.Z)(T,"defaultProps",k);const z=T,E=(0,o.Z)("form",{target:"ewxfxsb10"})("font-size:15px;line-height:22px;transition:padding 0.2s ease-in-out;",(e=>(e=>e.error?"\n  color: ".concat(e.theme.error,";\n  margin: -1px;\n  border: 1px solid ").concat(e.theme.error,";\n  border-radius: ").concat(e.theme.borderRadius,";\n\n    &:before {\n      display: block;\n      content: '';\n      width: 0;\n      height: 0;\n      border-top: 7px solid transparent;\n      border-bottom: 7px solid transparent;\n      border-right: 7px solid ").concat(e.theme.red300,";\n      position: absolute;\n      left: -7px;\n      top: 12px;\n    }\n\n    &:after {\n      display: block;\n      content: '';\n      width: 0;\n      height: 0;\n      border-top: 6px solid transparent;\n      border-bottom: 6px solid transparent;\n      border-right: 6px solid #fff;\n      position: absolute;\n      left: -5px;\n      top: 12px;\n    }\n  "):"")(e)),";"),I=(0,o.Z)("div",{target:"ewxfxsb9"})(u.Z,";"),F=(0,o.Z)("div",{target:"ewxfxsb8"})("display:flex;border-top:1px solid ",(e=>e.theme.border),";justify-content:space-between;transition:opacity 0.2s ease-in-out;padding-left:",(0,h.Z)(1.5),";"),H=(0,o.Z)(d.ZP,{target:"ewxfxsb7"})("font-size:13px;margin:-1px -1px -1px;border-radius:0 0 ",(e=>e.theme.borderRadius),";",(e=>e.error&&"\n  &, &:active, &:focus, &:hover {\n  border-bottom-color: ".concat(e.theme.error,";\n  border-right-color: ").concat(e.theme.error,";\n  }\n  ")),";"),L=(0,o.Z)("span",{target:"ewxfxsb6"})("display:flex;align-items:center;height:100%;color:",(e=>e.theme.error),";font-size:0.9em;"),P=(0,o.Z)(l.Z,{target:"ewxfxsb5"})("padding:",(0,h.Z)(1)," ",(0,h.Z)(2)," 0;border-bottom:1px solid ",(e=>e.theme.border),";margin-bottom:0;"),A=(0,o.Z)("li",{target:"ewxfxsb4"})({name:"1uwyn4z",styles:"margin-right:13px"}),B=(0,o.Z)("a",{target:"ewxfxsb3"})({name:"k7xpx9",styles:".nav-tabs>li>&{font-size:15px;padding-bottom:5px;}"}),D=(0,o.Z)(A,{target:"ewxfxsb2"})(".nav-tabs>&{display:flex;align-items:center;margin-right:0;color:",(e=>e.theme.subText),";float:right;}"),K=(0,o.Z)("span",{target:"ewxfxsb1"})("margin-left:",(0,h.Z)(.5),";font-size:14px;"),O=(0,o.Z)("div",{target:"ewxfxsb0"})((e=>(e=>{const{minHeight:t,padding:n,overflow:s,border:o}=_(e)["&multiLine"].input;return"\n  max-height: 1000px;\n  max-width: 100%;\n  ".concat(t&&"min-height: ".concat(t,"px")||"",";\n  padding: ").concat(n,";\n  overflow: ").concat(s,";\n  border: ").concat(o,";\n")})(e)),";padding-bottom:",(0,h.Z)(1),";")},"./app/components/activity/note/inputWithStorage.tsx":(e,t,n)=>{n.d(t,{Z:()=>m});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),o=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),i=n("../node_modules/@sentry/minimal/esm/index.js"),r=n("../node_modules/lodash/debounce.js"),a=n.n(r),d=n("./app/components/activity/note/input.tsx"),l=n("./app/utils/localStorage.tsx"),p=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class c extends o.Component{constructor(...e){super(...e),(0,s.Z)(this,"save",a()((e=>{const{itemKey:t,onSave:n}=this.props,s=this.fetchFromStorage()||{};this.saveToStorage({...s,[t]:n(e)})}),150)),(0,s.Z)(this,"handleChange",((e,t={})=>{const{onChange:n}=this.props;n&&n(e,t),t.updating||this.save(e.target.value)})),(0,s.Z)(this,"handleCreate",(e=>{const{itemKey:t,onCreate:n}=this.props;n&&n(e);const s=this.fetchFromStorage()||{};if(!s.hasOwnProperty(t))return;const{[t]:o,...i}=s;this.saveToStorage(i)}))}fetchFromStorage(){const{storageKey:e}=this.props,t=l.Z.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch(e){return i.$e((n=>{n.setExtra("storage",t),i.Tb(e)})),null}}saveToStorage(e){const{storageKey:t}=this.props;try{l.Z.setItem(t,JSON.stringify(e))}catch(t){i.Tb(t),i.$e((n=>{n.setExtra("storage",e),i.Tb(t)}))}}getValue(){const{itemKey:e,text:t,onLoad:n}=this.props;if(t)return t;const s=this.fetchFromStorage();return s&&s.hasOwnProperty(e)?n?n(s[e]):s[e]:""}render(){return(0,p.tZ)(d.Z,{...this.props,text:this.getValue(),onCreate:this.handleCreate,onChange:this.handleChange})}}c.displayName="NoteInputWithStorage",(0,s.Z)(c,"defaultProps",{onLoad:e=>e,onSave:e=>e});const m=c},"./app/components/links/linkWithConfirmation.tsx":(e,t,n)=>{n.d(t,{Z:()=>l});var s=n("../node_modules/react/index.js"),o=n("../node_modules/classnames/index.js"),i=n.n(o),r=n("./app/components/confirm.tsx"),a=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class d extends s.PureComponent{render(){const{className:e,disabled:t,title:n,children:s,...o}=this.props;return(0,a.tZ)(r.Z,{...o,disabled:t,children:(0,a.tZ)("a",{href:"#",className:i()(e||"",{disabled:t}),title:n,children:s})})}}d.displayName="LinkWithConfirmation";const l=d},"./app/utils/marked.tsx":(e,t,n)=>{n.d(t,{A:()=>u,Z:()=>g}),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=n("../node_modules/dompurify/dist/purify.js"),o=n.n(s),i=n("../node_modules/marked/lib/marked.js"),r=n.n(i),a=n("./app/constants/index.tsx");const d=/^(https?:|mailto:)/i,l=/^https?:\/\/./i;function p(e,t){try{return t.test(decodeURIComponent(unescape(e)))}catch{return!1}}class c extends r().Renderer{link(e,t,n){if(!p(e,d))return e;const s='<a href="'.concat(e,'"').concat(t?' title="'.concat(t,'"'):"",">").concat(n,"</a>");return o().sanitize(s)}image(e,t,n){return this.options.sanitize&&!p(e,l)?"":'<img src="'.concat(e,'" alt="').concat(n,'"').concat(t?' title="'.concat(t,'"'):""," />")}}class m extends c{paragraph(e){return e}}r().setOptions({renderer:new c,sanitize:!0,silent:!!a.Bo||"test"===a.lC});const h=(...e)=>o().sanitize(r()(...e)),u=(e,t={})=>h(e,{...t,renderer:new m}),g=h}}]);
//# sourceMappingURL=../sourcemaps/app_components_activity_note_index_tsx-app_components_activity_note_inputWithStorage_tsx.df7ade17b264c12c0362affb667e93ec.js.map