"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_utils_routeTitle_tsx-app_views_asyncView_tsx-app_views_releases_utils_releaseHealthRequest_tsx"],{"./app/utils/routeTitle.tsx":(e,t,s)=>{s.d(t,{Z:()=>o});const o=function(e,t,s=!0,o){const a="".concat(e," - ").concat(t),r=o?"".concat(a," - ").concat(o):a;return s?"".concat(r," - Sentry"):r}},"./app/views/asyncView.tsx":(e,t,s)=>{s.d(t,{Z:()=>i}),s("../node_modules/react/index.js");var o=s("../node_modules/react-document-title/index.js"),a=s.n(o),r=s("./app/components/asyncComponent.tsx"),n=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends r.Z{getTitle(){return""}render(){const e=this.getTitle();return(0,n.tZ)(a(),{title:"".concat(e?"".concat(e," - "):"","Sentry"),children:this.renderComponent()})}}i.displayName="AsyncView"},"./app/views/releases/list/utils.tsx":(e,t,s)=>{let o,a,r;s.d(t,{Y7:()=>o,zY:()=>a,L4:()=>r}),function(e){e.CRASH_FREE_USERS="crash_free_users",e.CRASH_FREE_SESSIONS="crash_free_sessions",e.USERS_24_HOURS="users_24h",e.SESSIONS_24_HOURS="sessions_24h",e.SESSIONS="sessions",e.DATE="date",e.BUILD="build",e.SEMVER="semver",e.ADOPTION="adoption"}(o||(o={})),function(e){e.USERS="users",e.SESSIONS="sessions"}(a||(a={})),function(e){e.ACTIVE="active",e.ARCHIVED="archived"}(r||(r={}))},"./app/views/releases/utils/index.tsx":(e,t,s)=>{s.d(t,{hf:()=>v,G5:()=>P,Mf:()=>g,zB:()=>S,r:()=>f,G$:()=>C,PS:()=>j,eY:()=>B,TB:()=>R,rF:()=>I,gs:()=>w,C8:()=>_,O7:()=>x}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var o=s("../node_modules/lodash/pick.js"),a=s.n(o),r=s("../node_modules/lodash/round.js"),n=s.n(r),i=s("../node_modules/moment/moment.js"),l=s.n(i),u=s("./app/components/organizations/globalSelectionHeader/getParams.tsx"),d=s("./app/constants/globalSelectionHeader.tsx"),c=s("./app/locale.tsx"),h=s("./app/types/index.tsx"),p=s("./app/utils/tokenizeSearch.tsx"),y=s("./app/views/issueList/utils.tsx"),m=s("./app/views/releases/list/utils.tsx");const v=95,P=e=>n()(e,e>60?0:3),g=(e,t=v,s=3)=>{const o=n()(e,e>t?s:0);return 100===o&&e<100?Math.floor(e*Math.pow(10,s))/Math.pow(10,s):o},S=(e,t=v,s=3)=>{if(isNaN(e))return"â€•";if(e<1&&e>0)return"<1%";const o=g(e,t,s).toLocaleString();return"".concat(o,"%")},f=(e,t=!0)=>n()(t?Math.abs(e):e,3),C=(e,t=!0)=>"".concat(f(e,t).toLocaleString(),"%"),j=(e,t,s)=>({pathname:"/organizations/".concat(e,"/issues/"),query:{project:t,statsPeriod:void 0,start:void 0,end:void 0,query:new p.MY(["firstRelease:".concat(s)]).formatString(),sort:y.qh.FREQ}}),B=(e,t,s,o={})=>({pathname:"/organizations/".concat(e,"/issues/"),query:{...o,project:t,query:new p.MY(["release:".concat(s),"error.unhandled:true"]).formatString(),sort:y.qh.FREQ}}),R=(e,t,s,o={})=>({pathname:"/organizations/".concat(e,"/issues/"),query:{...o,project:t,query:new p.MY(["release:".concat(s),"error.handled:true"]).formatString(),sort:y.qh.FREQ}}),I=e=>e.status===h.dE.Archived;function w(e,t){return e===m.zY.USERS?(0,c.tn)("user","users",t):(0,c.tn)("session","sessions",t)}function _(e){var t;const{lastEvent:s,currentProjectMeta:o,dateCreated:a}=e||{},{sessionsUpperBound:r}=o||{},n=l()(a).startOf("minute").utc().format(),i=l()(null!==(t=l()(r).isAfter(s)?r:s)&&void 0!==t?t:void 0).endOf("minute").utc().format();return l()(n).isSame(i,"minute")?{releaseStart:n,releaseEnd:l()(i).add(1,"minutes").utc().format()}:{releaseStart:n,releaseEnd:i}}function x({location:e,releaseBounds:t,defaultStatsPeriod:s,allowEmptyPeriod:o}){const r=(0,u.Q)(a()(e.query,[...Object.values(d.nF),...Object.values(d.V),"cursor"]),{allowAbsolutePageDatetime:!0,defaultStatsPeriod:s,allowEmptyPeriod:o});return Object.keys(r).some((e=>[d.nF.START,d.nF.END,d.nF.UTC,d.nF.PERIOD].includes(e)))||(r[d.nF.START]=t.releaseStart,r[d.nF.END]=t.releaseEnd),r}},"./app/views/releases/utils/releaseHealthRequest.tsx":(e,t,s)=>{s.d(t,{Yr:()=>w,pE:()=>_,ZP:()=>b});var o=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),r=s("../node_modules/lodash/isEqual.js"),n=s.n(r),i=s("../node_modules/lodash/omit.js"),l=s.n(i),u=s("../node_modules/lodash/pick.js"),d=s.n(u),c=s("../node_modules/moment/moment.js"),h=s.n(c),p=s("./app/actionCreators/indicator.tsx"),y=s("./app/components/charts/utils.tsx"),m=s("./app/components/organizations/globalSelectionHeader/getParams.tsx"),v=s("./app/constants/globalSelectionHeader.tsx"),P=s("./app/locale.tsx"),g=s("./app/types/index.tsx"),S=s("./app/utils.tsx"),f=s("./app/utils/tokenizeSearch.tsx"),C=s("./app/utils/withApi.tsx"),j=s("./app/views/releases/list/utils.tsx"),B=s("./app/views/releases/utils/index.tsx");function R(e){return l()(e,["api","organization","children","selection.datetime.utc","location"])}function I(e){const t=(0,y.Nm)(e);return t>=y.$i?"1d":t>=y.IZ?"6h":t>y.w3?"4h":"1h"}function w(e,t,s){var o;return null===(o=t.series[s])||void 0===o||o.forEach(((t,s)=>{var o;return e[s]=(null!==(o=e[s])&&void 0!==o?o:0)+t})),e}function _(e){switch(e){case j.zY.USERS:return"count_unique(user)";case j.zY.SESSIONS:default:return"sum(session)"}}class x extends a.Component{constructor(...e){super(...e),(0,o.Z)(this,"state",{loading:!1,errored:!1,statusCountByReleaseInPeriod:null,totalCountByReleaseIn24h:null,totalCountByProjectIn24h:null,statusCountByProjectInPeriod:null,totalCountByReleaseInPeriod:null,totalCountByProjectInPeriod:null}),(0,o.Z)(this,"fetchData",(async()=>{const{api:e,healthStatsPeriod:t,disable:s}=this.props;if(s)return;e.clear(),this.setState({loading:!0,errored:!1,statusCountByReleaseInPeriod:null,totalCountByReleaseIn24h:null,totalCountByProjectIn24h:null});const o=[this.fetchStatusCountByReleaseInPeriod(),this.fetchTotalCountByReleaseIn24h(),this.fetchTotalCountByProjectIn24h()];t===g.$A.AUTO&&(o.push(this.fetchStatusCountByProjectInPeriod()),o.push(this.fetchTotalCountByReleaseInPeriod()),o.push(this.fetchTotalCountByProjectInPeriod()));try{const[e,t,s,a,r,n]=await Promise.all(o);this.setState({loading:!1,statusCountByReleaseInPeriod:e,totalCountByReleaseIn24h:t,totalCountByProjectIn24h:s,statusCountByProjectInPeriod:a,totalCountByReleaseInPeriod:r,totalCountByProjectInPeriod:n})}catch(e){var a,r;(0,p.Iw)(null!==(a=null===(r=e.responseJSON)||void 0===r?void 0:r.detail)&&void 0!==a?a:(0,P.t)("Error loading health data")),this.setState({loading:!1,errored:!0})}})),(0,o.Z)(this,"getHealthData",(()=>({getCrashCount:this.getCrashCount,getCrashFreeRate:this.getCrashFreeRate,get24hCountByRelease:this.get24hCountByRelease,get24hCountByProject:this.get24hCountByProject,getTimeSeries:this.getTimeSeries,getAdoption:this.getAdoption}))),(0,o.Z)(this,"getCrashCount",((e,t,s)=>{var o;const{statusCountByReleaseInPeriod:a}=this.state,r=_(s);return null==a||null===(o=a.groups.find((({by:s})=>s.release===e&&s.project===t&&"crashed"===s["session.status"])))||void 0===o?void 0:o.totals[r]})),(0,o.Z)(this,"getCrashFreeRate",((e,t,s)=>{var o;const{statusCountByReleaseInPeriod:a}=this.state,r=_(s),n=null==a||null===(o=a.groups.filter((({by:s})=>s.release===e&&s.project===t)))||void 0===o?void 0:o.reduce(((e,t)=>e+t.totals[r]),0),i=this.getCrashCount(e,t,s);return(0,S.ri)(n)&&0!==n?(0,B.Mf)(100-(0,S.aQ)(null!=i?i:0,null!=n?n:0)):null})),(0,o.Z)(this,"get24hCountByRelease",((e,t,s)=>{var o;const{totalCountByReleaseIn24h:a}=this.state,r=_(s);return null==a||null===(o=a.groups.filter((({by:s})=>s.release===e&&s.project===t)))||void 0===o?void 0:o.reduce(((e,t)=>e+t.totals[r]),0)})),(0,o.Z)(this,"getPeriodCountByRelease",((e,t,s)=>{var o;const{totalCountByReleaseInPeriod:a}=this.state,r=_(s);return null==a||null===(o=a.groups.filter((({by:s})=>s.release===e&&s.project===t)))||void 0===o?void 0:o.reduce(((e,t)=>e+t.totals[r]),0)})),(0,o.Z)(this,"get24hCountByProject",((e,t)=>{var s;const{totalCountByProjectIn24h:o}=this.state,a=_(t);return null==o||null===(s=o.groups.filter((({by:t})=>t.project===e)))||void 0===s?void 0:s.reduce(((e,t)=>e+t.totals[a]),0)})),(0,o.Z)(this,"getPeriodCountByProject",((e,t)=>{var s;const{totalCountByProjectInPeriod:o}=this.state,a=_(t);return null==o||null===(s=o.groups.filter((({by:t})=>t.project===e)))||void 0===s?void 0:s.reduce(((e,t)=>e+t.totals[a]),0)})),(0,o.Z)(this,"getTimeSeries",((e,t,s)=>{const{healthStatsPeriod:o}=this.props;return o===g.$A.AUTO?this.getPeriodTimeSeries(e,t,s):this.get24hTimeSeries(e,t,s)})),(0,o.Z)(this,"get24hTimeSeries",((e,t,s)=>{var o,a,r;const{totalCountByReleaseIn24h:n,totalCountByProjectIn24h:i}=this.state,l=_(s),u=null!==(o=null==i?void 0:i.intervals)&&void 0!==o?o:[],d=null==i||null===(a=i.groups.find((({by:e})=>e.project===t)))||void 0===a?void 0:a.series[l],c=null==n||null===(r=n.groups.find((({by:s})=>s.project===t&&s.release===e)))||void 0===r?void 0:r.series[l];return[{seriesName:(0,P.t)("This Release"),data:null==u?void 0:u.map(((e,t)=>{var s;return{name:h()(e).valueOf(),value:null!==(s=null==c?void 0:c[t])&&void 0!==s?s:0}}))},{seriesName:(0,P.t)("Total Project"),data:null==u?void 0:u.map(((e,t)=>{var s;return{name:h()(e).valueOf(),value:null!==(s=null==d?void 0:d[t])&&void 0!==s?s:0}})),z:0}]})),(0,o.Z)(this,"getPeriodTimeSeries",((e,t,s)=>{var o,a,r;const{statusCountByReleaseInPeriod:n,statusCountByProjectInPeriod:i}=this.state,l=_(s),u=null!==(o=null==i?void 0:i.intervals)&&void 0!==o?o:[],d=null==i||null===(a=i.groups.filter((({by:e})=>e.project===t)))||void 0===a?void 0:a.reduce(((e,t)=>w(e,t,l)),[]),c=null==n||null===(r=n.groups.filter((({by:s})=>s.project===t&&s.release===e)))||void 0===r?void 0:r.reduce(((e,t)=>w(e,t,l)),[]);return[{seriesName:(0,P.t)("This Release"),data:null==u?void 0:u.map(((e,t)=>{var s;return{name:h()(e).valueOf(),value:null!==(s=null==c?void 0:c[t])&&void 0!==s?s:0}}))},{seriesName:(0,P.t)("Total Project"),data:null==u?void 0:u.map(((e,t)=>{var s;return{name:h()(e).valueOf(),value:null!==(s=null==d?void 0:d[t])&&void 0!==s?s:0}})),z:0}]})),(0,o.Z)(this,"getAdoption",((e,t,s)=>{const{healthStatsPeriod:o}=this.props,a=(o===g.$A.AUTO?this.getPeriodCountByRelease:this.get24hCountByRelease)(e,t,s),r=(o===g.$A.AUTO?this.getPeriodCountByProject:this.get24hCountByProject)(t,s);return(0,S.ri)(a)&&(0,S.ri)(r)?(0,S.aQ)(a,r):void 0}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){this.props.releasesReloading||n()(R(e),R(this.props))||this.fetchData()}get path(){const{organization:e}=this.props;return"/organizations/".concat(e.slug,"/sessions/")}get baseQueryParams(){const{location:e,selection:t,defaultStatsPeriod:s,releases:o}=this.props;return{query:new f.MY(o.reduce(((e,t,s,o)=>(e.push('release:"'.concat(t,'"')),s<o.length-1&&e.push("OR"),e)),[])).formatString(),interval:I(t.datetime),...(0,m.Q)(d()(e.query,Object.values(v.nF)),{defaultStatsPeriod:s})}}async fetchStatusCountByReleaseInPeriod(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,field:[...new Set([...t.map((e=>_(e))),"sum(session)"])],groupBy:["project","release","session.status"]}})}async fetchStatusCountByProjectInPeriod(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,query:void 0,field:[...new Set([...t.map((e=>_(e))),"sum(session)"])],groupBy:["project","session.status"]}})}async fetchTotalCountByReleaseIn24h(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,field:t.map((e=>_(e))),groupBy:["project","release"],interval:"1h",statsPeriod:"24h"}})}async fetchTotalCountByReleaseInPeriod(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,field:t.map((e=>_(e))),groupBy:["project","release"]}})}async fetchTotalCountByProjectIn24h(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,query:void 0,field:t.map((e=>_(e))),groupBy:["project"],interval:"1h",statsPeriod:"24h"}})}async fetchTotalCountByProjectInPeriod(){const{api:e,display:t}=this.props;return await e.requestPromise(this.path,{query:{...this.baseQueryParams,query:void 0,field:t.map((e=>_(e))),groupBy:["project"]}})}render(){const{loading:e,errored:t}=this.state,{children:s}=this.props;return s({isHealthLoading:e,errored:t,getHealthData:this.getHealthData()})}}x.displayName="ReleaseHealthRequest";const b=(0,C.Z)(x)}}]);
//# sourceMappingURL=../sourcemaps/app_utils_routeTitle_tsx-app_views_asyncView_tsx-app_views_releases_utils_releaseHealthRequest_tsx.f0261e5eae090a030d28f262a49ffaca.js.map