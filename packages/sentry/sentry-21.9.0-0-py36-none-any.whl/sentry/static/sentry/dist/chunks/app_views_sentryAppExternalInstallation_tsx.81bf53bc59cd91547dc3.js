(self.webpackChunk=self.webpackChunk||[]).push([["app_views_sentryAppExternalInstallation_tsx"],{"./app/actionCreators/sentryAppInstallations.tsx":(t,e,n)=>{"use strict";n.d(e,{G:()=>i,W:()=>a});var s=n("./app/actionCreators/indicator.tsx"),r=n("./app/locale.tsx");function i(t,e,n){(0,s.E3)();const i=t.requestPromise("/organizations/".concat(e,"/sentry-app-installations/"),{method:"POST",data:{slug:n.slug}});return i.then((()=>(0,s.B8)()),(()=>(0,s.Iw)((0,r.t)("Unable to install ".concat(n.name))))),i}function a(t,e){(0,s.E3)();const n=t.requestPromise("/sentry-app-installations/".concat(e.uuid,"/"),{method:"DELETE"});return n.then((()=>{(0,s.S9)((0,r.t)("".concat(e.app.slug," successfully uninstalled.")))}),(()=>(0,s.B8)())),n}},"./app/utils/consolidatedScopes.tsx":(t,e,n)=>{"use strict";n.d(e,{A:()=>y,m:()=>h}),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=n("../node_modules/lodash/groupBy.js"),r=n.n(s),i=n("../node_modules/lodash/invertBy.js"),a=n.n(i),o=n("../node_modules/lodash/pick.js"),l=n.n(o);const c={read:0,write:1,admin:2},d={project:"Project",team:"Team",release:"Release",event:"Event",org:"Organization",member:"Member"},p={Project:"no-access",Team:"no-access",Release:"no-access",Event:"no-access",Organization:"no-access",Member:"no-access"},g="project:releases",u=t=>{const e=t.split(":")[1];return c[e]},m=(t,e)=>u(t)-u(e);function h(t){const e={...p};let n=[...t];var s;return t.includes(g)&&(e.Release="admin",n=t.filter((t=>t!==g))),(s=n,Object.values(r()(s,(t=>t.split(":")[0]))).map((t=>t.sort(m))).map((t=>t.pop()))).forEach((t=>{if(t){const[n,s]=t.split(":");e[d[n]]=s}})),e}function y(t){const e=h(t);return{read:[],write:[],admin:[],...l()(a()(e),["read","write","admin"])}}},"./app/utils/marked.tsx":(t,e,n)=>{"use strict";n.d(e,{A:()=>m,Z:()=>h}),n("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=n("../node_modules/dompurify/dist/purify.js"),r=n.n(s),i=n("../node_modules/marked/lib/marked.js"),a=n.n(i),o=n("./app/constants/index.tsx");const l=/^(https?:|mailto:)/i,c=/^https?:\/\/./i;function d(t,e){try{return e.test(decodeURIComponent(unescape(t)))}catch{return!1}}class p extends a().Renderer{link(t,e,n){if(!d(t,l))return t;const s='<a href="'.concat(t,'"').concat(e?' title="'.concat(e,'"'):"",">").concat(n,"</a>");return r().sanitize(s)}image(t,e,n){return this.options.sanitize&&!d(t,c)?"":'<img src="'.concat(t,'" alt="').concat(n,'"').concat(e?' title="'.concat(e,'"'):""," />")}}class g extends p{paragraph(t){return t}}a().setOptions({renderer:new p,sanitize:!0,silent:!!o.Bo||"test"===o.lC});const u=(...t)=>r().sanitize(a()(...t)),m=(t,e={})=>u(t,{...e,renderer:new g}),h=u},"./app/views/asyncView.tsx":(t,e,n)=>{"use strict";n.d(e,{Z:()=>o}),n("../node_modules/react/index.js");var s=n("../node_modules/react-document-title/index.js"),r=n.n(s),i=n("./app/components/asyncComponent.tsx"),a=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class o extends i.Z{getTitle(){return""}render(){const t=this.getTitle();return(0,a.tZ)(r(),{title:"".concat(t?"".concat(t," - "):"","Sentry"),children:this.renderComponent()})}}o.displayName="AsyncView"},"./app/views/sentryAppExternalInstallation.tsx":(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>G});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("./app/actionCreators/indicator.tsx")),a=n("./app/actionCreators/sentryAppInstallations.tsx"),o=n("./app/components/alert.tsx"),l=n("./app/components/avatar/organizationAvatar.tsx"),c=n("./app/components/forms/selectControl.tsx"),d=(n("../node_modules/core-js/modules/es.string.replace.js"),n("../node_modules/core-js/modules/es.symbol.description.js"),n("../node_modules/react/index.js")),p=n("./app/components/acl/access.tsx"),g=n("./app/components/asyncComponent.tsx"),u=n("./app/components/button.tsx"),m=n("./app/components/circleIndicator.tsx"),h=n("./app/components/tag.tsx"),y=n("./app/icons/index.tsx"),Z=n("./app/locale.tsx"),x=n("./app/plugins/components/pluginIcon.tsx"),f=n("./app/styles/space.tsx"),v=n("./app/utils/consolidatedScopes.tsx"),z=n("./app/utils/integrationUtil.tsx"),_=n("./app/utils/marked.tsx"),j=n("./app/utils/recordSentryAppInteraction.tsx"),w=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class b extends g.Z{componentDidUpdate(t){this.props.organization.id!==t.organization.id&&this.trackOpened()}componentDidMount(){this.trackOpened()}trackOpened(){const{sentryApp:t,organization:e,isInstalled:n}=this.props;(0,j.E)(t.slug,"sentry_app_viewed"),(0,z.Db)("integrations.install_modal_opened",{integration_type:"sentry_app",integration:t.slug,already_installed:n,view:"external_install",integration_status:t.status,organization:e},{startSession:!0})}getEndpoints(){const{sentryApp:t}=this.props;return[["featureData","/sentry-apps/".concat(t.slug,"/features/")]]}featureTags(t){return t.map((t=>{const e=t.featureGate.replace(/integrations/g,"");return(0,w.tZ)(M,{children:e.replace(/-/g," ")},e)}))}get permissions(){return(0,v.A)(this.props.sentryApp.scopes)}async onInstall(){const{onInstall:t}=this.props;try{await t()}catch(t){}}renderPermissions(){const t=this.permissions;return 0===Object.keys(t).filter((e=>t[e].length>0)).length?null:(0,w.BX)(d.Fragment,{children:[(0,w.tZ)(P,{children:"Permissions"}),t.read.length>0&&(0,w.BX)(N,{children:[(0,w.tZ)(X,{}),(0,w.tZ)(C,{children:(0,Z._N)("[read] access to [resources] resources",{read:(0,w.tZ)("strong",{children:"Read"}),resources:t.read.join(", ")})},"read")]}),t.write.length>0&&(0,w.BX)(N,{children:[(0,w.tZ)(X,{}),(0,w.tZ)(C,{children:(0,Z._N)("[read] and [write] access to [resources] resources",{read:(0,w.tZ)("strong",{children:"Read"}),write:(0,w.tZ)("strong",{children:"Write"}),resources:t.write.join(", ")})},"write")]}),t.admin.length>0&&(0,w.BX)(N,{children:[(0,w.tZ)(X,{}),(0,w.tZ)(C,{children:(0,Z._N)("[admin] access to [resources] resources",{admin:(0,w.tZ)("strong",{children:"Admin"}),resources:t.admin.join(", ")})},"admin")]})]})}renderBody(){const{sentryApp:t,closeModal:e,isInstalled:n,organization:s}=this.props,{featureData:r}=this.state,i=(r||[]).map((t=>({featureGate:t.featureGate,description:(0,w.tZ)("span",{dangerouslySetInnerHTML:{__html:(0,_.A)(t.description)}})}))),{FeatureList:a,IntegrationFeatures:o}=(0,z.bh)(),l=t.overview||"",c={organization:s,features:i};return(0,w.BX)(d.Fragment,{children:[(0,w.BX)(A,{children:[(0,w.tZ)(x.ZP,{pluginId:t.slug,size:50}),(0,w.BX)(I,{children:[(0,w.tZ)(S,{children:t.name}),!!i.length&&(0,w.tZ)(F,{children:this.featureTags(i)})]})]}),(0,w.tZ)(O,{dangerouslySetInnerHTML:{__html:(0,_.Z)(l)}}),(0,w.tZ)(a,{...c,provider:{...t,key:t.slug}}),(0,w.tZ)(o,{...c,children:({disabled:r,disabledReason:i})=>(0,w.BX)(d.Fragment,{children:[!r&&this.renderPermissions(),(0,w.BX)(E,{children:[(0,w.tZ)(k,{children:(0,Z.t)("Authored By %s",t.author)}),(0,w.BX)("div",{children:[r&&(0,w.tZ)(B,{reason:i}),(0,w.tZ)(u.ZP,{size:"small",onClick:e,children:(0,Z.t)("Cancel")}),(0,w.tZ)(p.Z,{organization:s,access:["org:integrations"],children:({hasAccess:t})=>t&&(0,w.tZ)(u.ZP,{size:"small",priority:"primary",disabled:n||r,onClick:()=>this.onInstall(),style:{marginLeft:(0,f.Z)(1)},"data-test-id":"install",children:(0,Z.t)("Accept & Install")})})]})]})]})})]})}}const A=(0,r.Z)("div",{target:"e1hor01j12"})("display:grid;grid-template-columns:max-content 1fr;grid-gap:",(0,f.Z)(1),";align-items:center;margin-bottom:",(0,f.Z)(2),";"),I=(0,r.Z)("div",{target:"e1hor01j11"})({name:"4runny",styles:"display:grid;grid-template-rows:max-content max-content;align-items:start"}),S=(0,r.Z)("div",{target:"e1hor01j10"})({name:"1k5apmu",styles:"font-weight:bold;font-size:1.4em"}),O=(0,r.Z)("div",{target:"e1hor01j9"})("font-size:1.5rem;line-height:2.1rem;margin-bottom:",(0,f.Z)(2),";li{margin-bottom:6px;}"),k=(0,r.Z)("div",{target:"e1hor01j8"})("color:",(t=>t.theme.gray300),";"),B=(0,r.Z)((({reason:t,...e})=>(0,w.BX)("div",{...e,children:[(0,w.tZ)(y.Gy,{color:"red300",size:"1.5em"}),t]})),{target:"e1hor01j7"})("display:grid;align-items:center;flex:1;grid-template-columns:max-content 1fr;color:",(t=>t.theme.red300),";font-size:0.9em;"),C=(0,r.Z)("p",{target:"e1hor01j6"})({name:"1x9ekz7",styles:"margin:0px 6px"}),N=(0,r.Z)("div",{target:"e1hor01j5"})({name:"zjik7",styles:"display:flex"}),E=(0,r.Z)("div",{target:"e1hor01j4"})({name:"1348q18",styles:"display:flex;padding:20px 30px;border-top:1px solid #e2dee6;margin:20px -30px -30px;justify-content:space-between"}),P=(0,r.Z)("p",{target:"e1hor01j3"})("margin-bottom:",(0,f.Z)(1),";font-weight:bold;"),X=(0,r.Z)((t=>(0,w.tZ)(m.Z,{size:7,...t})),{target:"e1hor01j2"})("margin-top:7px;color:",(t=>t.theme.success),";"),F=(0,r.Z)("div",{target:"e1hor01j1"})("margin:-",(0,f.Z)(.5),";"),M=(0,r.Z)(h.Z,{target:"e1hor01j0"})("padding:",(0,f.Z)(.5),";");var R=n("./app/components/narrowLayout.tsx"),T=n("./app/utils/queryString.tsx"),q=n("./app/views/asyncView.tsx"),D=n("./app/views/settings/components/forms/field/index.tsx");class G extends q.Z{constructor(...t){super(...t),(0,s.Z)(this,"hasAccess",(t=>t.access.includes("org:integrations"))),(0,s.Z)(this,"onClose",(()=>{const{selectedOrgSlug:t}=this.state,e=document.referrer||"/settings/".concat(t,"/integrations/");window.location.assign(e)})),(0,s.Z)(this,"onInstall",(async()=>{const{organization:t,sentryApp:e}=this.state;if(!t||!e)return;(0,z.Db)("integrations.installation_start",{integration_type:"sentry_app",integration:e.slug,view:"external_install",integration_status:e.status,organization:t});const n=await(0,a.G)(this.api,t.slug,e);if("installed"===n.status&&(0,z.Db)("integrations.installation_complete",{integration_type:"sentry_app",integration:e.slug,view:"external_install",integration_status:e.status,organization:t}),e.redirectUrl){const s={installationId:n.uuid,code:n.code,orgSlug:t.slug},r=(0,T.Yi)(e.redirectUrl,s);return window.location.assign(r)}return this.onClose()})),(0,s.Z)(this,"onSelectOrg",(async t=>{this.setState({selectedOrgSlug:t,reloading:!0});try{const[e,n]=await Promise.all([this.api.requestPromise("/organizations/".concat(t,"/")),this.api.requestPromise("/organizations/".concat(t,"/sentry-app-installations/"))]),s=n.map((t=>t.app.slug)).includes(this.sentryAppSlug);this.setState({organization:e,isInstalled:s,reloading:!1})}catch(t){(0,i.Iw)((0,Z.t)("Failed to retrieve organization or integration details")),this.setState({reloading:!1})}})),(0,s.Z)(this,"onRequestSuccess",(({stateKey:t,data:e})=>{"organizations"===t&&1===e.length&&this.onSelectOrg(e[0].slug)}))}getDefaultState(){return{...super.getDefaultState(),selectedOrgSlug:null,organization:null,organizations:[],reloading:!1}}getEndpoints(){return[["organizations","/organizations/"],["sentryApp","/sentry-apps/".concat(this.sentryAppSlug,"/")]]}getTitle(){return(0,Z.t)("Choose Installation Organization")}get sentryAppSlug(){return this.props.params.sentryAppSlug}get isSingleOrg(){return 1===this.state.organizations.length}get isSentryAppInternal(){const{sentryApp:t}=this.state;return t&&"internal"===t.status}get isSentryAppUnavailableForOrg(){var t;const{sentryApp:e,selectedOrgSlug:n}=this.state;return n&&(null==e||null===(t=e.owner)||void 0===t?void 0:t.slug)!==n&&"unpublished"===e.status}get disableInstall(){const{reloading:t,isInstalled:e}=this.state;return e||t||this.isSentryAppUnavailableForOrg}getOptions(){return this.state.organizations.map((t=>[t.slug,(0,w.BX)("div",{children:[(0,w.tZ)(l.Z,{organization:t}),(0,w.tZ)(V,{children:t.slug})]},t.slug)]))}renderInternalAppError(){const{sentryApp:t}=this.state;return(0,w.tZ)(o.Z,{type:"error",icon:(0,w.tZ)(y.Gy,{size:"md"}),children:(0,Z._N)("Integration [sentryAppName] is an internal integration. Internal integrations are automatically installed",{sentryAppName:(0,w.tZ)("strong",{children:t.name})})})}checkAndRenderError(){const{organization:t,selectedOrgSlug:e,isInstalled:n,sentryApp:s}=this.state;if(e&&t&&!this.hasAccess(t))return(0,w.BX)(o.Z,{type:"error",icon:(0,w.tZ)(y.Gy,{size:"md"}),children:[(0,w.tZ)("p",{children:(0,Z._N)("You do not have permission to install integrations in\n          [organization]. Ask an organization owner or manager to\n          visit this page to finish installing this integration.",{organization:(0,w.tZ)("strong",{children:t.slug})})}),(0,w.tZ)(U,{children:window.location.href})]});if(n&&t)return(0,w.tZ)(o.Z,{type:"error",icon:(0,w.tZ)(y.Gy,{size:"md"}),children:(0,Z._N)("Integration [sentryAppName] already installed for [organization]",{organization:(0,w.tZ)("strong",{children:t.name}),sentryAppName:(0,w.tZ)("strong",{children:s.name})})});if(this.isSentryAppUnavailableForOrg){var r,i;const t=null!==(r=null==s||null===(i=s.owner)||void 0===i?void 0:i.slug)&&void 0!==r?r:"another organization";return(0,w.tZ)(o.Z,{type:"error",icon:(0,w.tZ)(y.Gy,{size:"md"}),children:(0,Z._N)("Integration [sentryAppName] is an unpublished integration for [otherOrg]. An unpublished integration can only be installed on the organization which created it.",{sentryAppName:(0,w.tZ)("strong",{children:s.name}),otherOrg:(0,w.tZ)("strong",{children:t})})})}return null}renderMultiOrgView(){const{selectedOrgSlug:t,sentryApp:e}=this.state;return(0,w.BX)("div",{children:[(0,w.tZ)("p",{children:(0,Z._N)("Please pick a specific [organization:organization] to install [sentryAppName]",{organization:(0,w.tZ)("strong",{}),sentryAppName:(0,w.tZ)("strong",{children:e.name})})}),(0,w.tZ)(D.Z,{label:(0,Z.t)("Organization"),inline:!1,stacked:!0,required:!0,children:()=>(0,w.tZ)(c.Z,{onChange:({value:t})=>this.onSelectOrg(t),value:t,placeholder:(0,Z.t)("Select an organization"),choices:this.getOptions()})})]})}renderSingleOrgView(){const{organizations:t,sentryApp:e}=this.state,n=t[0].name;return(0,w.tZ)("div",{children:(0,w.tZ)("p",{children:(0,Z._N)("You are installing [sentryAppName] for organization [organization]",{organization:(0,w.tZ)("strong",{children:n}),sentryAppName:(0,w.tZ)("strong",{children:e.name})})})})}renderMainContent(){const{organization:t,sentryApp:e}=this.state;return(0,w.BX)("div",{children:[(0,w.tZ)(Y,{children:this.isSingleOrg?this.renderSingleOrgView():this.renderMultiOrgView()}),this.checkAndRenderError(),t&&(0,w.tZ)(b,{sentryApp:e,organization:t,onInstall:this.onInstall,closeModal:this.onClose,isInstalled:this.disableInstall})]})}renderBody(){return(0,w.tZ)(R.Z,{children:(0,w.BX)(L,{children:[(0,w.tZ)("h3",{children:(0,Z.t)("Finish integration installation")}),this.isSentryAppInternal?this.renderInternalAppError():this.renderMainContent()]})})}}const U=(0,r.Z)("pre",{target:"e14lyx9n3"})({name:"1iee5id",styles:"margin-bottom:0;background:#fbe3e1"}),V=(0,r.Z)("span",{target:"e14lyx9n2"})({name:"1qkltea",styles:"margin-left:5px"}),L=(0,r.Z)("div",{target:"e14lyx9n1"})({name:"qkomnt",styles:"margin-bottom:40px"}),Y=(0,r.Z)("div",{target:"e14lyx9n0"})({name:"1azpx8r",styles:"margin-bottom:20px"})},"../node_modules/lodash/_baseInverter.js":(t,e,n)=>{var s=n("../node_modules/lodash/_baseForOwn.js");t.exports=function(t,e,n,r){return s(t,(function(t,s,i){e(r,n(t),s,i)})),r}},"../node_modules/lodash/_createInverter.js":(t,e,n)=>{var s=n("../node_modules/lodash/_baseInverter.js");t.exports=function(t,e){return function(n,r){return s(n,t,e(r),{})}}},"../node_modules/lodash/invertBy.js":(t,e,n)=>{var s=n("../node_modules/lodash/_baseIteratee.js"),r=n("../node_modules/lodash/_createInverter.js"),i=Object.prototype,a=i.hasOwnProperty,o=i.toString,l=r((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=o.call(e)),a.call(t,e)?t[e].push(n):t[e]=[n]}),s);t.exports=l}}]);
//# sourceMappingURL=../sourcemaps/app_views_sentryAppExternalInstallation_tsx.785625352a2293d77088442cd5e0ee58.js.map