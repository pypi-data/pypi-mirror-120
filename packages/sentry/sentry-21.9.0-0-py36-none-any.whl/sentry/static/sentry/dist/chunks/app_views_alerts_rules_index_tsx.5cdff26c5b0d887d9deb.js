"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_views_alerts_rules_index_tsx","app_components_sentryDocumentTitle_tsx"],{"./app/components/sentryDocumentTitle.tsx":(e,t,n)=>{n.d(t,{Z:()=>o}),n("../node_modules/react/index.js");var s=n("../node_modules/react-document-title/index.js"),a=n.n(s),i=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function r({title:e,orgSlug:t,projectSlug:n,children:s}){const r=t||n?t&&n?"".concat(e," - ").concat(t," - ").concat(n):t?"".concat(e," - ").concat(t):"".concat(e," - ").concat(n):e;return(0,i.tZ)(a(),{title:"".concat(r," - Sentry"),children:s})}r.displayName="SentryDocumentTitle";const o=r},"./app/views/alerts/alertBadge.tsx":(e,t,n)=>{n.d(t,{Z:()=>c});var s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=n("./app/icons/index.tsx"),i=n("./app/locale.tsx"),r=n("./app/styles/space.tsx"),o=n("./app/views/alerts/types.tsx"),l=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d({status:e,hideText:t=!1,isIssue:n}){let s=(0,i.t)("Resolved"),r=a.DL,d="green300";return n?(s=(0,i.t)("Issue"),r=a.XI,d="gray300"):e===o.vt.CRITICAL?(s=(0,i.t)("Critical"),r=a.zC,d="red300"):e===o.vt.WARNING&&(s=(0,i.t)("Warning"),r=a.FC,d="yellow300"),(0,l.BX)(p,{displayFlex:!t,children:[(0,l.tZ)(u,{color:d,icon:r,children:(0,l.tZ)(r,{color:"white"})}),!t&&(0,l.tZ)(m,{color:d,children:s})]})}d.displayName="AlertBadge";const c=d,p=(0,s.Z)("div",{target:"e1ov36c52"})("display:",(e=>e.displayFlex?"flex":"block"),";align-items:center;"),u=(0,s.Z)("div",{target:"e1ov36c51"})("display:flex;align-items:center;justify-content:center;flex-shrink:0;line-height:",(e=>e.icon===a.FC?void 0:1),";left:3px;min-width:30px;&:before{content:'';position:absolute;width:22px;height:22px;border-radius:",(e=>e.theme.borderRadius),";background-color:",(e=>e.theme[e.color]),";transform:rotate(45deg);}svg{width:",(e=>e.icon===a.XI?"11px":"13px"),";z-index:1;}"),m=(0,s.Z)("div",{target:"e1ov36c50"})("margin-left:",(0,r.Z)(1),";color:",(e=>e.theme[e.color]),";")},"./app/views/alerts/rules/index.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>me});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),i=(n("../node_modules/core-js/modules/web.dom-collections.iterator.js"),n("../node_modules/react/index.js")),r=n("../node_modules/lodash/flatten.js"),o=n.n(r),l=n("./app/actionCreators/indicator.tsx"),d=n("./app/components/asyncComponent.tsx"),c=n("./app/components/layouts/thirds.tsx"),p=n("./app/components/links/externalLink.tsx"),u=n("./app/components/links/link.tsx"),m=n("./app/components/organizations/globalSelectionHeader/index.tsx"),h=n("./app/components/pagination.tsx"),g=n("./app/components/panels/index.tsx"),x=n("./app/components/searchBar.tsx"),Z=n("./app/components/sentryDocumentTitle.tsx"),v=n("./app/icons/index.tsx"),y=n("./app/locale.tsx"),f=n("./app/styles/space.tsx"),w=n("./app/utils/analytics.tsx"),b=n("./app/utils/projects.tsx"),I=n("./app/utils/withGlobalSelection.tsx"),C=n("./app/utils/withTeams.tsx"),q=n("./app/views/alerts/list/header.tsx"),j=n("./app/views/alerts/utils/index.tsx"),B=n("../node_modules/lodash/memoize.js"),_=n.n(B),A=n("./app/components/acl/access.tsx"),L=n("./app/components/actions/menuItemActionLink.tsx"),z=n("./app/components/avatar/actorAvatar.tsx"),S=n("./app/components/button.tsx"),k=n("./app/components/buttonBar.tsx"),D=n("./app/components/confirm.tsx"),T=n("./app/components/dateTime.tsx"),R=n("./app/components/dropdownLink.tsx"),X=n("./app/components/errorBoundary.tsx"),N=n("./app/components/idBadge/index.tsx"),E=n("./app/components/timeSince.tsx"),G=n("./app/components/tooltip.tsx"),F=n("./app/styles/overflowEllipsis.tsx"),P=n("./app/utils/getDynamicText.tsx"),M=n("./app/views/alerts/incidentRules/types.tsx"),V=n("./app/views/alerts/alertBadge.tsx"),W=n("./app/views/alerts/types.tsx"),O=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class Y extends i.Component{constructor(...e){super(...e),(0,s.Z)(this,"getProject",_()(((e,t)=>t.find((t=>t.slug===e)))))}activeIncident(){var e;const{rule:t}=this.props;return void 0!==(null===(e=t.latestIncident)||void 0===e?void 0:e.status)&&[W.vt.CRITICAL,W.vt.WARNING].includes(t.latestIncident.status)}renderLastIncidentDate(){const{rule:e}=this.props;return(0,j.Gm)(e)?null:e.latestIncident?this.activeIncident()?(0,O.BX)("div",{children:[(0,y.t)("Triggered "),(0,O.tZ)(E.Z,{date:e.latestIncident.dateCreated})]}):(0,O.BX)("div",{children:[(0,y.t)("Resolved "),(0,O.tZ)(E.Z,{date:e.latestIncident.dateClosed})]}):"-"}renderAlertRuleStatus(){var e,t;const{rule:n}=this.props;if((0,j.Gm)(n))return null;const s=this.activeIncident(),a=null==n?void 0:n.triggers.find((({label:e})=>"critical"===e)),i=null==n?void 0:n.triggers.find((({label:e})=>"warning"===e)),r=s&&(null===(e=n.latestIncident)||void 0===e?void 0:e.status)===W.vt.CRITICAL?a:null!=i?i:a;let o="green300";s&&(o="critical"===(null==r?void 0:r.label)?"red300":"warning"===(null==r?void 0:r.label)?"yellow300":"green300");const l=s&&n.thresholdType===M.lT.ABOVE?(0,y.t)("Above"):(0,y.t)("Below");return(0,O.BX)($,{children:[(0,O.tZ)(v.CC,{color:o,direction:s&&n.thresholdType===M.lT.ABOVE?"up":"down"}),(0,O.tZ)(ie,{children:"".concat(l," ").concat(null==r||null===(t=r.alertThreshold)||void 0===t?void 0:t.toLocaleString())})]})}render(){var e,t,n,s,a,r;const{rule:o,projectsLoaded:l,projects:d,organization:c,orgId:p,onDelete:m,userTeams:h}=this.props,g=o.projects[0],x="/organizations/".concat(p,"/alerts/").concat((0,j.Gm)(o)?"rules":"metric-rules","/").concat(g,"/").concat(o.id,"/"),Z=!(0,j.Gm)(o)&&c.features.includes("alert-details-redesign"),f="/organizations/".concat(p,"/alerts/rules/details/").concat(o.id,"/"),w=null===(e=o.owner)||void 0===e?void 0:e.split(":")[1],b=w?{type:"team",id:w,name:""}:null,I=!w||h.has(w),C=c.features.includes("alert-details-redesign"),q=(0,j.Gm)(o)?o.name:(0,O.tZ)(J,{to:Z?f:x,children:o.name}),B={[W.vt.CRITICAL]:(0,y.t)("Critical"),[W.vt.WARNING]:(0,y.t)("Warning"),[W.vt.CLOSED]:(0,y.t)("Resolved"),[W.vt.OPENED]:(0,y.t)("Resolved")};return(0,O.BX)(X.Z,{children:[C?(0,O.BX)(i.Fragment,{children:[(0,O.BX)(ee,{isIncident:(0,j.Gm)(o),children:[(0,O.tZ)($,{children:(0,O.tZ)(G.Z,{title:(0,j.Gm)(o)?(0,y.t)("Issue Alert"):(0,y._N)("Metric Alert Status: [status]",{status:B[null!==(t=null==o||null===(n=o.latestIncident)||void 0===n?void 0:n.status)&&void 0!==t?t:W.vt.CLOSED]}),children:(0,O.tZ)(V.Z,{status:null==o||null===(s=o.latestIncident)||void 0===s?void 0:s.status,isIssue:(0,j.Gm)(o),hideText:!0})})}),(0,O.BX)(te,{children:[(0,O.tZ)(ne,{children:q}),!(0,j.Gm)(o)&&this.renderLastIncidentDate()]})]}),(0,O.tZ)($,{children:this.renderAlertRuleStatus()})]}):(0,O.BX)(i.Fragment,{children:[(0,O.tZ)(H,{children:(0,j.Gm)(o)?(0,y.t)("Issue"):(0,y.t)("Metric")}),(0,O.tZ)(U,{children:q})]}),(0,O.tZ)($,{children:(0,O.tZ)(se,{children:(0,O.tZ)(ae,{avatarSize:18,project:l?this.getProject(g,d):{slug:g}})})}),(0,O.tZ)($,{children:b?(0,O.tZ)(z.Z,{actor:b,size:24}):"-"}),!C&&(0,O.tZ)(Q,{children:null!==(a=null==o||null===(r=o.createdBy)||void 0===r?void 0:r.name)&&void 0!==a?a:"-"}),(0,O.tZ)($,{children:(0,O.tZ)(T.Z,{date:(0,P.Z)({value:o.dateCreated,fixed:new Date("2021-04-20")}),format:"ll"})}),(0,O.tZ)(le,{children:(0,O.tZ)(A.Z,{access:["alerts:write"],children:({hasAccess:e})=>(0,O.BX)(i.Fragment,{children:[(0,O.tZ)(oe,{children:(0,O.BX)(R.Z,{anchorRight:!0,caret:!1,title:(0,O.tZ)(S.ZP,{tooltipProps:{containerDisplayMode:"flex"},size:"small",type:"button","aria-label":(0,y.t)("Show more"),icon:(0,O.tZ)(v.YR,{size:"xs"})}),children:[(0,O.tZ)("li",{children:(0,O.tZ)(u.Z,{to:x,children:(0,y.t)("Edit")})}),(0,O.tZ)(D.Z,{disabled:!e||!I,message:(0,y._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:o.name}),header:(0,y.t)("Delete Alert Rule?"),priority:"danger",confirmText:(0,y.t)("Delete Rule"),onConfirm:()=>m(g,o),children:(0,O.tZ)(L.Z,{title:(0,y.t)("Delete"),children:(0,y.t)("Delete")})})]})}),(0,O.BX)(re,{gap:1,children:[(0,O.tZ)(D.Z,{disabled:!e||!I,message:(0,y._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:o.name}),header:(0,y.t)("Delete Alert Rule?"),priority:"danger",confirmText:(0,y.t)("Delete Rule"),onConfirm:()=>m(g,o),children:(0,O.tZ)(S.ZP,{type:"button",icon:(0,O.tZ)(v.Fz,{}),size:"small",title:(0,y.t)("Delete")})}),(0,O.tZ)(G.Z,{title:(0,y.t)("Edit"),children:(0,O.tZ)(S.ZP,{size:"small",type:"button",icon:(0,O.tZ)(v.iC,{}),to:x})})]})]})})})]})}}Y.displayName="RuleListRow";const K={name:"1fkdlfr",styles:"display:flex;flex-direction:column;align-items:flex-start;height:100%"},H=(0,a.Z)("div",{target:"e1f6xqs313"})("font-size:",(e=>e.theme.fontSizeSmall),";font-weight:400;color:",(e=>e.theme.gray300),";text-transform:uppercase;",K,";"),U=(0,a.Z)("div",{target:"e1f6xqs312"})(K,";"),J=(0,a.Z)(u.Z,{target:"e1f6xqs311"})(F.Z,";"),Q=(0,a.Z)("div",{target:"e1f6xqs310"})(F.Z," ",K,";"),$=(0,a.Z)("div",{target:"e1f6xqs39"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),ee=(0,a.Z)($,{target:"e1f6xqs38"})((e=>e.isIncident&&"padding: ".concat((0,f.Z)(3)," ").concat((0,f.Z)(2),"; line-height: 2.4;")),";"),te=(0,a.Z)("div",{target:"e1f6xqs37"})(F.Z," margin-left:",(0,f.Z)(1.5),";line-height:1.35;"),ne=(0,a.Z)("div",{target:"e1f6xqs36"})(F.Z," font-size:",(e=>e.theme.fontSizeLarge),";@media (max-width: ",(e=>e.theme.breakpoints[3]),"){max-width:300px;}@media (max-width: ",(e=>e.theme.breakpoints[2]),"){max-width:165px;}@media (max-width: ",(e=>e.theme.breakpoints[1]),"){max-width:100px;}"),se=(0,a.Z)("div",{target:"e1f6xqs35"})({name:"1d3w5wq",styles:"width:100%"}),ae=(0,a.Z)(N.Z,{target:"e1f6xqs34"})({name:"ozd7xs",styles:"flex-shrink:0"}),ie=(0,a.Z)("div",{target:"e1f6xqs33"})("margin-left:",(0,f.Z)(1),";white-space:nowrap;"),re=(0,a.Z)(k.ZP,{target:"e1f6xqs32"})("display:none;justify-content:flex-start;align-items:center;@media (max-width: ",(e=>e.theme.breakpoints[1]),"){display:flex;}"),oe=(0,a.Z)("div",{target:"e1f6xqs31"})("display:none;@media (min-width: ",(e=>e.theme.breakpoints[1]),"){display:block;}"),le=(0,a.Z)($,{target:"e1f6xqs30"})("justify-content:center;padding:",(0,f.Z)(1),";"),de=Y;var ce=n("./app/views/alerts/rules/teamFilter.tsx");class pe extends d.Z{constructor(...e){super(...e),(0,s.Z)(this,"handleChangeFilter",((e,t)=>{const{router:n,location:s}=this.props,{cursor:a,page:i,...r}=s.query,o=[...t];n.push({pathname:s.pathname,query:{...r,team:o.length?o:""}})})),(0,s.Z)(this,"handleChangeSearch",(e=>{const{router:t,location:n}=this.props,{cursor:s,page:a,...i}=n.query;t.push({pathname:n.pathname,query:{...i,name:e}})})),(0,s.Z)(this,"handleDeleteRule",(async(e,t)=>{const{params:n}=this.props,{orgId:s}=n,a=(0,j.Gm)(t)?"rules":"alert-rules";try{await this.api.requestPromise("/projects/".concat(s,"/").concat(e,"/").concat(a,"/").concat(t.id,"/"),{method:"DELETE"}),this.reloadData()}catch(e){(0,l.Iw)((0,y.t)("Error deleting rule"))}}))}getEndpoints(){const{params:e,location:t,organization:n}=this.props,{query:s}=t;return n.features.includes("alert-details-redesign")&&(s.expand=["latestIncident"]),s.team=(0,ce.L)(s.team),n.features.includes("alert-details-redesign")&&!s.sort&&(s.sort=["incident_status","date_triggered"]),[["ruleList","/organizations/".concat(e&&e.orgId,"/combined-rules/"),{query:s}]]}renderLoading(){return this.renderBody()}renderFilterBar(){var e;const{teams:t,location:n}=this.props,s=new Set((0,ce.L)(n.query.team));return(0,O.BX)(xe,{children:[(0,O.tZ)(ce.Z,{teams:t,selectedTeams:s,handleChangeFilter:this.handleChangeFilter}),(0,O.tZ)(Ze,{placeholder:(0,y.t)("Search by name"),query:null===(e=n.query)||void 0===e?void 0:e.name,onSearch:this.handleChangeSearch})]})}renderList(){const{params:{orgId:e},location:{query:t},organization:n,teams:s}=this.props,{loading:a,ruleList:i=[],ruleListPageLinks:r}=this.state,l=new Set(o()(null==i?void 0:i.map((({projects:e})=>e)))),d={asc:"1"===t.asc,field:t.sort||"date_added"},{cursor:u,page:m,...g}=t,x=n.features.includes("alert-details-redesign"),Z=d.field.includes("incident_status")||d.field.includes("date_triggered"),f=(0,O.tZ)(v.CC,{color:"gray300",size:"xs",direction:d.asc?"up":"down"}),w=new Set(s.filter((({isMember:e})=>e)).map((({id:e})=>e)));return(0,O.tZ)(he,{children:(0,O.BX)(c.or,{fullWidth:!0,children:[this.renderFilterBar(),(0,O.tZ)(ve,{headers:[...x?[(0,O.BX)(ge,{to:{pathname:location.pathname,query:{...g,asc:"name"===d.field&&d.asc?void 0:"1",sort:"name"}},children:[(0,y.t)("Alert Rule")," ","name"===d.field&&f]}),(0,O.BX)(ge,{to:{pathname:location.pathname,query:{...g,asc:Z&&!d.asc?"1":void 0,sort:["incident_status","date_triggered"]}},children:[(0,y.t)("Status")," ",Z&&f]})]:[(0,y.t)("Type"),(0,O.BX)(ge,{to:{pathname:location.pathname,query:{...g,asc:"name"!==d.field||d.asc?void 0:"1",sort:"name"}},children:[(0,y.t)("Alert Name")," ","name"===d.field&&f]})],(0,y.t)("Project"),(0,y.t)("Team"),...x?[]:[(0,y.t)("Created By")],(0,O.BX)(ge,{to:{pathname:location.pathname,query:{...g,asc:"date_added"!==d.field||d.asc?void 0:"1",sort:"date_added"}},children:[(0,y.t)("Created")," ","date_added"===d.field&&f]}),(0,y.t)("Actions")],isLoading:a,isEmpty:0===(null==i?void 0:i.length),emptyMessage:(0,y.t)("No alert rules found for the current query."),emptyAction:(0,O.tZ)(ye,{children:(0,y._N)("Learn more about [link:Alerts]",{link:(0,O.tZ)(p.Z,{href:"https://docs.sentry.io/product/alerts-notifications/metric-alerts/"})})}),hasAlertList:x,children:(0,O.tZ)(b.Z,{orgId:e,slugs:Array.from(l),children:({initiallyLoaded:t,projects:s})=>i.map((a=>(0,O.tZ)(de,{projectsLoaded:t,projects:s,rule:a,orgId:e,onDelete:this.handleDeleteRule,organization:n,userTeams:w},"".concat((0,j.Gm)(a)?"metric":"issue","-").concat(a.id))))})}),(0,O.tZ)(h.Z,{pageLinks:r})]})})}renderBody(){const{params:e,organization:t,router:n}=this.props,{orgId:s}=e;return(0,O.tZ)(Z.Z,{title:(0,y.t)("Alerts"),orgSlug:s,children:(0,O.BX)(m.Z,{organization:t,showDateSelector:!1,showEnvironmentSelector:!1,children:[(0,O.tZ)(q.Z,{organization:t,router:n,activeTab:"rules"}),this.renderList()]})})}}class ue extends i.Component{componentDidMount(){this.trackView()}componentDidUpdate(e){var t,n;const{location:s}=this.props;(null===(t=e.location.query)||void 0===t?void 0:t.sort)!==(null===(n=s.query)||void 0===n?void 0:n.sort)&&this.trackView()}trackView(){const{organization:e,location:t}=this.props;(0,w.ec)({eventKey:"alert_rules.viewed",eventName:"Alert Rules: Viewed",organization_id:e.id,sort:Array.isArray(t.query.sort)?t.query.sort.join(","):t.query.sort})}render(){return(0,O.tZ)(pe,{...this.props})}}ue.displayName="AlertRulesListContainer";const me=(0,I.Z)((0,C.Z)(ue)),he=(0,a.Z)(c.uT,{target:"eddauwb5"})({name:"108qp7n",styles:"margin-bottom:-20px"}),ge=(0,a.Z)(u.Z,{target:"eddauwb4"})({name:"1sbdiq8",styles:"color:inherit;:hover{color:inherit;}"}),xe=(0,a.Z)("div",{target:"eddauwb3"})("display:flex;margin-bottom:",(0,f.Z)(1.5),";"),Ze=(0,a.Z)(x.Z,{target:"eddauwb2"})("flex-grow:1;margin-left:",(0,f.Z)(1.5),";"),ve=(0,a.Z)(g.KB,{target:"eddauwb1"})("overflow:auto;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){overflow:initial;}grid-template-columns:auto 1.5fr 1fr 1fr ",(e=>e.hasAlertList?"":"1fr")," 1fr auto;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";"),ye=(0,a.Z)("p",{target:"eddauwb0"})("font-size:",(e=>e.theme.fontSizeLarge),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_rules_index_tsx.27a7f93a2aeae716fab15bb39b6c2e0e.js.map