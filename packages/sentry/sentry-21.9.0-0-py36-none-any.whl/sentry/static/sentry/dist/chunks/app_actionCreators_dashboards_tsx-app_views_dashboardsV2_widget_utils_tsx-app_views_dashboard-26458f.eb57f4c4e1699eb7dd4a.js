"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_actionCreators_dashboards_tsx-app_views_dashboardsV2_widget_utils_tsx-app_views_dashboard-26458f"],{"./app/actionCreators/dashboards.tsx":(e,t,o)=>{o.d(t,{JR:()=>n,a_:()=>a,AK:()=>i,Y:()=>d,iM:()=>l,QL:()=>c});var s=o("./app/actionCreators/indicator.tsx"),r=o("./app/locale.tsx");function n(e,t,o,n){const{title:a,widgets:i}=o,d=e.requestPromise("/organizations/".concat(t,"/dashboards/"),{method:"POST",data:{title:a,widgets:i,duplicate:n}});return d.catch((e=>{var t;const o=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;o?(0,s.Iw)(o):(0,s.Iw)((0,r.t)("Unable to create dashboard"))})),d}function a(e,t,o){return e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(o,"/visit/"),{method:"POST"})}function i(e,t,o){const n=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(o,"/"),{method:"GET"});return n.catch((e=>{var t;const o=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;o?(0,s.Iw)(o):(0,s.Iw)((0,r.t)("Unable to load dashboard"))})),n}function d(e,t,o){const n={title:o.title,widgets:o.widgets},a=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(o.id,"/"),{method:"PUT",data:n});return a.catch((e=>{var t;const o=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;o?(0,s.Iw)(o):(0,s.Iw)((0,r.t)("Unable to update dashboard"))})),a}function l(e,t,o){const n=e.requestPromise("/organizations/".concat(t,"/dashboards/").concat(o,"/"),{method:"DELETE"});return n.catch((e=>{var t;const o=null!==(t=null==e?void 0:e.responseJSON)&&void 0!==t?t:null;o?(0,s.Iw)(o):(0,s.Iw)((0,r.t)("Unable to delete dashboard"))})),n}function c(e,t,o){return e.requestPromise("/organizations/".concat(t,"/dashboards/widgets/"),{method:"POST",data:o})}},"./app/components/charts/areaChart.tsx":(e,t,o)=>{o.d(t,{Z:()=>d});var s=o("../node_modules/react/index.js"),r=o("./app/components/charts/series/lineSeries.tsx"),n=o("./app/components/charts/baseChart.tsx"),a=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends s.Component{render(){const{series:e,stacked:t,colors:o,...s}=this.props;return(0,a.tZ)(n.Z,{...s,colors:o,series:e.map((({seriesName:e,data:s,...n},a)=>function(e={}){return(0,r.Z)({...e})}({stack:t?"area":void 0,name:e,data:s.map((({name:e,value:t})=>[e,t])),lineStyle:{color:null==o?void 0:o[a],opacity:1,width:.4},areaStyle:{color:null==o?void 0:o[a],opacity:1},animation:!1,animationThreshold:1,animationDuration:0,...n})))})}}i.displayName="AreaChart";const d=i},"./app/components/charts/chartZoom.tsx":(e,t,o)=>{o.d(t,{Z:()=>g});var s=o("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=o("../node_modules/react/index.js"),n=o("../node_modules/moment/moment.js"),a=o.n(n),i=o("../node_modules/query-string/index.js"),d=o("./app/actionCreators/globalSelection.tsx"),l=o("./app/components/charts/components/dataZoomInside.tsx"),c=o("./app/components/charts/components/toolBox.tsx"),p=o("./app/utils/callIfFunction.tsx"),u=o("./app/utils/dates.tsx");const h=e=>e?a().utc(e).format(a().HTML5_FMT.DATETIME_LOCAL_SECONDS):null;class m extends r.Component{constructor(e){super(e),(0,s.Z)(this,"history",void 0),(0,s.Z)(this,"currentPeriod",void 0),(0,s.Z)(this,"zooming",null),(0,s.Z)(this,"saveCurrentPeriod",(e=>{this.currentPeriod={period:e.period,start:h(e.start),end:h(e.end)}})),(0,s.Z)(this,"setPeriod",(({period:e,start:t,end:o},s=!1)=>{const{router:r,onZoom:n,usePageDate:a}=this.props,l=h(t),c=h(o);s&&this.history.push(this.currentPeriod),(0,p.g)(n,{period:e,start:l,end:c}),this.zooming=()=>{if(a&&r){const s={...r.location.query,pageStart:t?(0,u.v5)(t):void 0,pageEnd:o?(0,u.v5)(o):void 0,pageStatsPeriod:null!=e?e:void 0};i.stringify(s)!==i.stringify(r.location.query)&&r.push({pathname:r.location.pathname,query:s})}else(0,d.dR)({period:e,start:l?(0,u.hC)(l):l,end:c?(0,u.hC)(c):c},r);this.saveCurrentPeriod({period:e,start:t,end:o})}})),(0,s.Z)(this,"handleChartReady",(e=>{e.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0}),(0,p.g)(this.props.onChartReady,e)})),(0,s.Z)(this,"handleZoomRestore",((e,t)=>{this.history.length&&(this.setPeriod(this.history[0]),this.history=[],(0,p.g)(this.props.onRestore,e,t))})),(0,s.Z)(this,"handleDataZoom",((e,t)=>{const o=t.getModel(),{xAxis:s}=o.option,r=s[0];if(null===r.rangeStart&&null===r.rangeEnd){const e=this.history.pop();if(!e)return;this.setPeriod(e)}else{const e=a().utc(r.rangeStart),t=a().utc(r.rangeEnd);this.setPeriod({period:null,start:e,end:t},!0)}(0,p.g)(this.props.onDataZoom,e,t)})),(0,s.Z)(this,"handleChartFinished",(()=>{"function"==typeof this.zooming&&(this.zooming(),this.zooming=null),(0,p.g)(this.props.onFinished)})),this.history=[],this.saveCurrentPeriod(e)}componentDidUpdate(){this.props.disabled||this.saveCurrentPeriod(this.props)}render(){const{utc:e,start:t,end:o,disabled:s,children:r,xAxisIndex:n,router:a,onZoom:i,onRestore:d,onChartReady:p,onDataZoom:h,onFinished:m,...g}=this.props,b=null!=e?e:void 0,v=t?(0,u.hC)(t):void 0,y=o?(0,u.hC)(o):void 0;return r(s?{utc:b,start:v,end:y,...g}:{isGroupedByDate:!0,onChartReady:this.handleChartReady,utc:b,start:v,end:y,dataZoom:(0,l.Z)({xAxisIndex:n}),showTimeInTooltip:!0,toolBox:(0,c.Z)({},{dataZoom:{title:{zoom:"",back:""},iconStyle:{borderWidth:0,color:"transparent",opacity:0}}}),onDataZoom:this.handleDataZoom,onFinished:this.handleChartFinished,onRestore:this.handleZoomRestore,...g})}}m.displayName="ChartZoom";const g=m},"./app/components/charts/components/visualMap.tsx":(e,t,o)=>{function s(e){return e}o.d(t,{Z:()=>s}),o("../node_modules/echarts/lib/component/visualMap.js")},"./app/components/charts/transitionChart.tsx":(e,t,o)=>{o.d(t,{Z:()=>d});var s=o("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=(o("../node_modules/core-js/modules/web.dom-collections.iterator.js"),o("../node_modules/react/index.js")),n=o("./app/components/charts/loadingPanel.tsx"),a=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class i extends r.Component{constructor(...e){super(...e),(0,s.Z)(this,"state",{prevReloading:this.props.reloading,prevLoading:this.props.loading,key:1})}static getDerivedStateFromProps(e,t){const o=t.prevReloading,s=e.reloading,r=t.prevLoading,n=e.loading;return r!==n?{prevReloading:s,prevLoading:n,key:t.key+1}:n?{prevReloading:s,prevLoading:n,key:t.key}:o&&!s?{prevReloading:s,prevLoading:n,key:t.key+1}:{prevReloading:s,prevLoading:n,key:t.key}}render(){const{height:e,loading:t,reloading:o}=this.props;return t&&!o?(0,a.tZ)(n.Z,{height:e,"data-test-id":"events-request-loading"}):(0,a.tZ)(r.Fragment,{children:this.props.children},String(this.state.key))}}i.displayName="TransitionChart",(0,s.Z)(i,"defaultProps",{height:"200px"});const d=i},"./app/components/charts/transparentLoadingMask.tsx":(e,t,o)=>{o.d(t,{Z:()=>a});var s=o("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=(o("../node_modules/react/index.js"),o("./app/components/loadingMask.tsx")),n=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const a=(0,s.Z)((({className:e,visible:t,children:o,...s})=>{const a=t?{...s,"data-test-id":"loading-placeholder"}:s;return(0,n.tZ)(r.Z,{className:e,...a,children:o})}),{target:"ewtkxp50"})((e=>!e.visible&&"display: none;"),";opacity:0.4;z-index:1;")},"./app/views/dashboardsV2/contextMenu.tsx":(e,t,o)=>{o.d(t,{Z:()=>u});var s=o("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=o("../node_modules/classnames/index.js"),n=o.n(r),a=o("./app/components/dropdownMenu.tsx"),i=o("./app/icons/index.tsx"),d=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const l=({children:e})=>(0,d.tZ)(a.Z,{children:({isOpen:t,getRootProps:o,getActorProps:s,getMenuProps:r})=>{const a=n()("dropdown",{"anchor-right":!0,open:t});return(0,d.BX)(c,{...o({className:a}),children:[(0,d.tZ)(p,{...s({onClick:e=>{e.stopPropagation(),e.preventDefault()}}),children:(0,d.tZ)(i.YR,{"data-test-id":"context-menu",size:"md"})}),t&&(0,d.tZ)("ul",{...r({}),className:n()("dropdown-menu"),children:e})]})}});l.displayName="ContextMenu";const c=(0,s.Z)("span",{target:"e1xn1f5x1"})("display:flex;color:",(e=>e.theme.textColor),";"),p=(0,s.Z)("div",{target:"e1xn1f5x0"})({name:"1y7emqs",styles:"display:flex;cursor:pointer;padding:0 5px"}),u=l},"./app/views/dashboardsV2/types.tsx":(e,t,o)=>{let s,r;o.d(t,{F:()=>s,n:()=>r}),function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area"}(s||(s={})),function(e){e.VIEW="view",e.EDIT="edit",e.CREATE="create",e.PENDING_DELETE="pending_delete"}(r||(r={}))},"./app/views/dashboardsV2/utils.tsx":(e,t,o)=>{o.d(t,{qk:()=>c,tT:()=>p,y1:()=>h}),o("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=o("../node_modules/lodash/cloneDeep.js"),r=o.n(s),n=o("../node_modules/lodash/pick.js"),a=o.n(n),i=o("./app/utils/dates.tsx"),d=o("./app/utils/discover/eventView.tsx"),l=o("./app/views/dashboardsV2/types.tsx");function c(e){return r()(e)}function p(e,t,o,s){const{start:r,end:n,period:a}=o.datetime,{projects:c,environments:p}=o,u=s===l.F.WORLD_MAP?["geo.country_code",...t.fields]:t.fields,h=s===l.F.WORLD_MAP?"".concat(t.conditions," has:geo.country_code"):t.conditions;return d.ZP.fromSavedQuery({id:void 0,name:e,version:2,fields:u,query:h,orderby:t.orderby,projects:c,range:a,start:r?(0,i.v5)(r):void 0,end:n?(0,i.v5)(n):void 0,environment:p})}function u(e){return"string"==typeof e?[e]:e}function h(e){if(e){const t=u(e.queryNames),o=u(e.queryConditions),s=u(e.queryFields),r=[];if(o&&t&&s&&"string"==typeof e.queryOrderby&&o.forEach(((o,n)=>{r.push({name:t[n],conditions:o,fields:s,orderby:e.queryOrderby})})),e.title&&e.displayType&&e.interval&&r.length>0)return{...a()(e,["title","displayType","interval"]),queries:r}}}},"./app/views/dashboardsV2/widget/utils.tsx":(e,t,o)=>{o.d(t,{FO:()=>r,qg:()=>n,hV:()=>a});var s=o("./app/locale.tsx");let r,n;!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area"}(r||(r={})),function(e){e.EVENTS="events",e.METRICS="metrics"}(n||(n={}));const a={[r.AREA]:(0,s.t)("Area Chart"),[r.BAR]:(0,s.t)("Bar Chart"),[r.LINE]:(0,s.t)("Line Chart"),[r.TABLE]:(0,s.t)("Table"),[r.WORLD_MAP]:(0,s.t)("World Map"),[r.BIG_NUMBER]:(0,s.t)("Big Number")}},"./app/views/dashboardsV2/widgetCard.tsx":(e,t,o)=>{o.d(t,{Z:()=>ve});var s=o("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=o("../node_modules/react/index.js"),n=o("../node_modules/react-router/es/index.js"),a=o("../node_modules/lodash/isEqual.js"),i=o.n(a),d=o("./app/actionCreators/modal.tsx"),l=o("./app/components/charts/styles.tsx"),c=o("./app/components/errorBoundary.tsx"),p=o("./app/components/menuItem.tsx"),u=o("./app/components/organizations/globalSelectionHeader/utils.tsx"),h=o("./app/components/panels/index.tsx"),m=o("./app/components/placeholder.tsx"),g=o("./app/icons/index.tsx"),b=o("./app/locale.tsx"),v=o("./app/styles/overflowEllipsis.tsx"),y=o("./app/styles/space.tsx"),Z=o("./app/utils/analytics.tsx"),x=o("./app/utils/withApi.tsx"),f=o("./app/utils/withGlobalSelection.tsx"),w=o("./app/utils/withOrganization.tsx"),C=o("./app/views/dashboardsV2/utils.tsx"),_=o("./app/views/dashboardsV2/contextMenu.tsx"),R=o("../node_modules/@emotion/react/dist/emotion-element-a8309070.browser.esm.js"),j=o("./app/components/charts/areaChart.tsx"),T=o("./app/components/charts/barChart.tsx"),M=o("./app/components/charts/chartZoom.tsx"),S=o("./app/components/charts/errorPanel.tsx"),D=o("./app/components/charts/lineChart.tsx"),E=o("./app/components/panels/panelTable.tsx"),q=o("./app/utils/discover/fieldRenderers.tsx"),k=o("./app/utils/discover/fields.tsx"),A=o("./app/views/eventsV2/utils.tsx"),P=o("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class z extends r.Component{renderRow(e,t,o,s){const{location:r,organization:n}=this.props;return s.map((s=>{const a=(0,q.Js)(s.name,o)(t,{organization:n,location:r});return(0,P.tZ)(L,{children:a},"".concat(e,":").concat(s.name))}))}render(){const{className:e,loading:t,fields:o,metadata:s,data:n,title:a}=this.props,i=null!=s?s:{},d=(0,A.Hg)(o.map((e=>({field:e}))));return(0,P.BX)(r.Fragment,{children:[a&&(0,P.tZ)("h4",{children:a}),(0,P.tZ)(N,{className:e,isLoading:t,headers:d.map(((e,t)=>{const o=(0,k.qG)(e.name,e.type,i);return(0,P.tZ)(I,{align:o,children:e.name},t)})),isEmpty:!(null!=n&&n.length),disablePadding:!0,children:null==n?void 0:n.map(((e,t)=>this.renderRow(t,e,i,d)))})]})}}z.displayName="SimpleTableChart";const N=(0,s.Z)(E.Z,{target:"e3tr8vk2"})("border-radius:0;border-left:0;border-right:0;border-bottom:0;margin:0;",E.z,"{height:min-content;}"),I=(0,s.Z)("div",{target:"e3tr8vk1"})((e=>e.align?"text-align: ".concat(e.align,";"):"")," padding:",(0,y.Z)(1)," ",(0,y.Z)(3),";"),L=(0,s.Z)("div",{target:"e3tr8vk0"})("padding:",(0,y.Z)(1)," ",(0,y.Z)(3),";"),O=(0,w.Z)(z);var B=o("./app/components/charts/transitionChart.tsx"),F=o("./app/components/charts/transparentLoadingMask.tsx"),W=o("./app/components/charts/utils.tsx"),V=o("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),U=(o("../node_modules/core-js/modules/web.dom-collections.iterator.js"),o("../node_modules/core-js/modules/es.object.from-entries.js"),o("../node_modules/echarts/index.js")),X=o.n(U),G=o("../node_modules/lodash/max.js"),J=o.n(G),Q=o("./app/components/charts/components/visualMap.tsx");o("../node_modules/echarts/lib/chart/map.js");var H=o("./app/components/charts/baseChart.tsx");class K extends r.Component{constructor(...e){super(...e),(0,V.Z)(this,"state",{countryToCodeMap:null,map:null,codeToCountryMap:null})}async componentDidMount(){const[e,t]=await Promise.all([o.e("app_data_countryCodesMap_tsx").then(o.bind(o,"./app/data/countryCodesMap.tsx")),o.e("app_data_world_json").then(o.t.bind(o,"./app/data/world.json",19))]);X().registerMap("sentryWorld",t.default),this.setState({countryToCodeMap:e.default,map:t.default,codeToCountryMap:Object.fromEntries(Object.entries(e.default).map((([e,t])=>[t,e])))})}render(){const{countryToCodeMap:e,map:t}=this.state;if(null===e||null===t)return null;const{series:o,seriesOptions:s,theme:r,...n}=this.props,a=o.map((({seriesName:e,data:t,...o})=>{var n;return function(e={}){return{roam:!0,itemStyle:{emphasis:{label:{show:!1}}},...e,type:"map"}}({...s,...o,map:"sentryWorld",name:e,nameMap:null!==(n=this.state.countryToCodeMap)&&void 0!==n?n:void 0,aspectScale:.85,zoom:1.3,center:[10.97,9.71],itemStyle:{areaColor:r.gray200,borderColor:r.backgroundSecondary,emphasis:{areaColor:r.orange300}},label:{emphasis:{show:!1}},data:t})})),i=J()(o.map((({data:e})=>J()(e.map((({value:e})=>e))))))||1;return(0,P.tZ)(H.Z,{options:{backgroundColor:r.background,visualMap:[(0,Q.Z)({left:"right",min:0,max:i,inRange:{color:[r.purple200,r.purple300]},text:["High","Low"],textStyle:{color:r.textColor},calculable:!1})]},...n,yAxis:null,xAxis:null,series:a,tooltip:{formatter:e=>{var t;const{marker:o,name:s,value:r}=Array.isArray(e)?e[0]:e;if(isNaN(r))return"";const n="number"==typeof r?r.toLocaleString():"",a=(null===(t=this.state.codeToCountryMap)||void 0===t?void 0:t[s])||s;return['<div class="tooltip-series tooltip-series-solo">\n                 <div><span class="tooltip-label">'.concat(o," <strong>").concat(a,"</strong></span> ").concat(n,"</div>\n              </div>"),'<div class="tooltip-arrow"></div>'].join("")}}})}}K.displayName="WorldMapChart";const Y=(0,R.b)(K);var $=o("./app/components/loadingIndicator.tsx"),ee=o("./app/utils/discover/charts.tsx"),te=o("./app/utils/getDynamicText.tsx");class oe extends r.Component{shouldComponentUpdate(e){const t={...this.props,widget:{...this.props.widget,title:""}};return e={...e,widget:{...e.widget,title:""}},!i()(t,e)}tableResultComponent({loading:e,errorMessage:t,tableResults:o}){const{location:s,widget:r,organization:n}=this.props;return t?(0,P.tZ)(S.Z,{children:(0,P.tZ)(g.FC,{color:"gray500",size:"lg"})}):void 0===o||e?(0,P.tZ)(m.Z,{height:"200px"}):o.map(((t,a)=>{var i,d;const l=null!==(i=null===(d=r.queries[a])||void 0===d?void 0:d.fields)&&void 0!==i?i:[];return(0,P.tZ)(ie,{location:s,fields:l,title:o.length>1?t.title:"",loading:e,metadata:t.meta,data:t.data,organization:n},"table:".concat(t.title))}))}bigNumberComponent({loading:e,errorMessage:t,tableResults:o}){return t?(0,P.tZ)(S.Z,{children:(0,P.tZ)(g.FC,{color:"gray500",size:"lg"})}):void 0===o||e?(0,P.tZ)(ne,{children:"—"}):o.map((e=>{var t;const o=null!==(t=e.meta)&&void 0!==t?t:{},s=Object.keys(null!=o?o:{})[0];if(!s||!e.data.length)return(0,P.tZ)(ne,{children:"—"},"big_number:".concat(e.title));const r=e.data[0],n=(0,q.fK)(s,o)(r);return(0,P.tZ)(ne,{children:n},"big_number:".concat(e.title))}))}chartComponent(e){const{widget:t}=this.props;switch(t.displayType){case"bar":return(0,P.tZ)(T.Z,{...e});case"area":return(0,P.tZ)(j.Z,{stacked:!0,...e});case"world_map":return(0,P.tZ)(Y,{...e});case"line":default:return(0,P.tZ)(D.Z,{...e})}}render(){var e,t,o;const{theme:s,tableResults:r,timeseriesResults:n,errorMessage:a,loading:i,widget:d}=this.props;if("table"===d.displayType)return(0,P.BX)(B.Z,{loading:i,reloading:i,children:[(0,P.tZ)(re,{loading:i}),this.tableResultComponent({tableResults:r,loading:i,errorMessage:a})]});if("big_number"===d.displayType)return(0,P.BX)(B.Z,{loading:i,reloading:i,children:[(0,P.tZ)(re,{loading:i}),this.bigNumberComponent({tableResults:r,loading:i,errorMessage:a})]});if(a)return(0,P.tZ)(S.Z,{children:(0,P.tZ)(g.FC,{color:"gray500",size:"lg"})});const{location:l,router:c,selection:p}=this.props,{start:u,end:h,period:b,utc:v}=p.datetime;if("world_map"===d.displayType){const e={title:"",data:[]},t=()=>{var t;if(!r||!r.length)return e;const o=r[0],{data:s,meta:n}=o;if(!s||!s.length||!n)return e;const a=Object.keys(n).find((e=>"geo.country_code"!==e));return a?{title:null!==(t=o.title)&&void 0!==t?t:"",data:s.filter((e=>e["geo.country_code"])).map((e=>({name:e["geo.country_code"],value:e[a]})))}:e},{data:o,title:s}=t(),n=[{seriesName:s,data:o}];return(0,P.BX)(B.Z,{loading:i,reloading:i,children:[(0,P.tZ)(re,{loading:i}),(0,P.tZ)(ae,{children:(0,te.Z)({value:this.chartComponent({series:n}),fixed:(0,P.tZ)(m.Z,{height:"200px",testId:"skeleton-ui"})})})]})}const y={left:0,top:0,selected:(0,W.RI)(l),formatter:e=>{const t=(0,k.hW)(e);if(null!==t){const o=(0,k.b8)(t);null!==o&&(e=o.toUpperCase())}return e}},Z=null!==(e=null===(t=d.queries[0])||void 0===t||null===(o=t.fields)||void 0===o?void 0:o[0])&&void 0!==e?e:"count()",x={grid:{left:0,right:0,top:"40px",bottom:0},seriesOptions:{showSymbol:!1},tooltip:{trigger:"axis",valueFormatter:ee.CX},yAxis:{axisLabel:{color:s.chartLabel,formatter:e=>(0,ee.gu)(e,Z)}}};return(0,P.tZ)(M.Z,{router:c,period:b,start:u,end:h,utc:v,children:e=>{if(a)return(0,P.tZ)(S.Z,{children:(0,P.tZ)(g.FC,{color:"gray500",size:"lg"})});const t=n?s.charts.getColorPalette(n.length-2):[],o=n?n.map(((e,o)=>({...e,color:t[o]}))):[];return(0,P.BX)(B.Z,{loading:i,reloading:i,children:[(0,P.tZ)(re,{loading:i}),(0,P.tZ)(ae,{children:(0,te.Z)({value:this.chartComponent({...e,...x,legend:y,series:o}),fixed:(0,P.tZ)(m.Z,{height:"200px",testId:"skeleton-ui"})})})]})}})}}oe.displayName="WidgetCardChart";const se=(0,s.Z)((e=>(0,P.tZ)(F.Z,{...e,maskBackgroundColor:"transparent"})),{target:"e1od7x483"})({name:"1vcob1d",styles:"display:flex;justify-content:center;align-items:center"}),re=({loading:e})=>e?(0,P.tZ)(se,{visible:e,children:(0,P.tZ)($.Z,{mini:!0})}):null;re.displayName="LoadingScreen";const ne=(0,s.Z)("div",{target:"e1od7x482"})("font-size:32px;padding:",(0,y.Z)(1)," ",(0,y.Z)(3)," ",(0,y.Z)(3)," ",(0,y.Z)(3),";*{text-align:left!important;}"),ae=(0,s.Z)("div",{target:"e1od7x481"})("padding:0 ",(0,y.Z)(3)," ",(0,y.Z)(3),";"),ie=(0,s.Z)(O,{target:"e1od7x480"})("margin-top:",(0,y.Z)(1.5),";border-bottom-left-radius:",(e=>e.theme.borderRadius),";border-bottom-right-radius:",(e=>e.theme.borderRadius),";font-size:",(e=>e.theme.fontSizeMedium),";box-shadow:none;"),de=(0,R.b)(oe);o("../node_modules/core-js/modules/es.symbol.description.js");var le=o("./app/actionCreators/events.tsx"),ce=o("./app/utils/dates.tsx"),pe=o("./app/utils/discover/genericDiscoverQuery.tsx");function ue(e,t){return{seriesName:t,data:e.data.map((([e,t])=>({name:1e3*e,value:t.reduce(((e,{count:t})=>e+t),0)})))}}function he(e,t){let o=[];const s=e.name;if((0,W.Xe)(t)){const e=Object.keys(t).map((e=>{const o=s?"".concat(s," : ").concat(e):e,r=t[e];return[r.order||0,ue(r,o)]})).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));o=o.concat(e)}else{const r=e.fields[0],n=s?"".concat(s," : ").concat(r):r,a=ue(t,n);o.push(a)}return o}class me extends r.Component{constructor(...e){super(...e),(0,V.Z)(this,"state",{loading:!0,queryFetchID:void 0,errorMessage:void 0,timeseriesResults:void 0,rawResults:void 0,tableResults:void 0})}componentDidMount(){this.fetchData()}componentDidUpdate(e){var t;const{selection:o,widget:s}=this.props,[r,n]=e.widget.queries.map((e=>(e.fields=e.fields.filter((e=>!!e)),e))).reduce((([e,t],{name:o,...s})=>(e.push(o),t.push(s),[e,t])),[[],[]]),[a,d]=s.queries.map((e=>(e.fields=e.fields.filter((e=>!!e)),e))).reduce((([e,t],{name:o,...s})=>(e.push(o),t.push(s),[e,t])),[[],[]]);i()(s.displayType,e.widget.displayType)&&i()(s.interval,e.widget.interval)&&i()(d,n)&&i()(s.displayType,e.widget.displayType)&&(0,u.WO)(o,e.selection)?this.state.loading||i()(r,a)||(null===(t=this.state.rawResults)||void 0===t?void 0:t.length)!==s.queries.length||this.setState((e=>{const t=s.queries.reduce(((t,o,s)=>t.concat(he(o,e.rawResults[s]))),[]);return{...e,timeseriesResults:t}})):this.fetchData()}fetchEventData(e){const{selection:t,api:o,organization:s,widget:r}=this.props;let n=[];this.setState({tableResults:[]});const a=r.queries.map((e=>{const n=(0,C.tT)(r.title,e,t);let a="";const i={per_page:5,noPagination:!0};if("table"===r.displayType)a="/organizations/".concat(s.slug,"/eventsv2/"),i.referrer="api.dashboards.tablewidget";else if("big_number"===r.displayType)a="/organizations/".concat(s.slug,"/eventsv2/"),i.per_page=1,i.referrer="api.dashboards.bignumberwidget";else{if("world_map"!==r.displayType)throw Error("Expected widget displayType to be either big_number, table or world_map");a="/organizations/".concat(s.slug,"/events-geo/"),delete i.per_page,i.referrer="api.dashboards.worldmapwidget"}return(0,pe.A)(o,a,{...n.generateQueryStringObject(),...i})}));let i=0;a.forEach((async(t,o)=>{try{var s,d;const[l]=await t,c=l;c.title=null!==(s=null===(d=r.queries[o])||void 0===d?void 0:d.name)&&void 0!==s?s:"",n=[...n,c],this.setState((t=>t.queryFetchID!==e?t:{...t,tableResults:n}))}catch(e){var l;const t=(null==e||null===(l=e.responseJSON)||void 0===l?void 0:l.detail)||(0,b.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{i++,this.setState((t=>t.queryFetchID!==e?t:{...t,loading:i!==a.length}))}}))}fetchTimeseriesData(e){const{selection:t,api:o,organization:s,widget:r}=this.props;this.setState({timeseriesResults:[],rawResults:[]});const{environments:n,projects:a}=t,{start:i,end:d,period:l}=t.datetime,c=function(e,t){let o="bar"===e.displayType?"1d":e.interval;o||(o="5m");const s=(0,ce.YJ)(o);return(0,W.Nm)(t)/s>4e3?(0,W.ZS)(t,"high"):o}(r,{start:i,end:d,period:l}),p=r.queries.map((e=>{const t={organization:s,interval:c,start:i,end:d,project:a,environment:n,period:l,query:e.conditions,yAxis:e.fields,orderby:e.orderby,includePrevious:!1,referrer:"api.dashboards.timeserieswidget",partial:!0};return(0,le.lI)(o,t)}));let u=0;p.forEach((async(t,o)=>{try{const s=await t;this.setState((t=>{var n,a;if(t.queryFetchID!==e)return t;const i=(null!==(n=t.timeseriesResults)&&void 0!==n?n:[]).concat(he(r.queries[o],s));return{...t,timeseriesResults:i,rawResults:(null!==(a=t.rawResults)&&void 0!==a?a:[]).concat(s)}}))}catch(e){var s;const t=(null==e||null===(s=e.responseJSON)||void 0===s?void 0:s.detail)||(0,b.t)("An unknown error occurred.");this.setState({errorMessage:t})}finally{u++,this.setState((t=>t.queryFetchID!==e?t:{...t,loading:u!==p.length}))}}))}fetchData(){const{widget:e}=this.props,t=Symbol("queryFetchID");this.setState({loading:!0,errorMessage:void 0,queryFetchID:t}),["table","world_map","big_number"].includes(e.displayType)?this.fetchEventData(t):this.fetchTimeseriesData(t)}render(){const{children:e}=this.props,{loading:t,timeseriesResults:o,tableResults:s,errorMessage:r}=this.state;return e({loading:t,timeseriesResults:o,tableResults:s,errorMessage:r})}}me.displayName="WidgetQueries";const ge=me;class be extends r.Component{shouldComponentUpdate(e){return!i()(e.widget,this.props.widget)||!(0,u.WO)(e.selection,this.props.selection)||this.props.isEditing!==e.isEditing||this.props.isSorting!==e.isSorting||this.props.hideToolbar!==e.hideToolbar}isAllowWidgetsToDiscover(){const{organization:e}=this.props;return e.features.includes("connect-discover-and-dashboards")}renderToolbar(){const{onEdit:e,onDelete:t,draggableProps:o,hideToolbar:s,isEditing:r}=this.props;return r?(0,P.tZ)(xe,{children:(0,P.BX)(fe,{style:{visibility:s?"hidden":"visible"},children:[(0,P.tZ)(we,{children:(0,P.tZ)(Ce,{color:"textColor",...null==o?void 0:o.listeners,...null==o?void 0:o.attributes})}),(0,P.tZ)(we,{"data-test-id":"widget-edit",onClick:()=>{e()},children:(0,P.tZ)(g.yl,{color:"textColor"})}),(0,P.tZ)(we,{"data-test-id":"widget-delete",onClick:()=>{t()},children:(0,P.tZ)(g.Fz,{color:"textColor"})})]})}):null}renderContextMenu(){const{widget:e,selection:t,organization:o,showContextMenu:s}=this.props;if(!s)return null;const r=[];return("table"===e.displayType||this.isAllowWidgetsToDiscover())&&o.features.includes("discover-basic")&&e.queries.length&&r.push((0,P.tZ)(p.Z,{onClick:s=>{if(s.preventDefault(),(0,Z.ec)({eventKey:"dashboards2.tablewidget.open_in_discover",eventName:"Dashboards2: Table Widget - Open in Discover",organization_id:parseInt(this.props.organization.id,10)}),1===e.queries.length){const s=(0,C.tT)(e.title,e.queries[0],t,e.displayType);n.browserHistory.push(s.getResultsViewUrlTarget(o.slug))}else(0,d.openDashboardWidgetQuerySelectorModal)({organization:o,widget:e})},children:(0,b.t)("Open in Discover")},"open-discover")),r.length?(0,P.tZ)(je,{children:(0,P.tZ)(_.Z,{children:r})}):null}render(){const{widget:e,api:t,organization:o,selection:s,renderErrorMessage:n,location:a,router:i}=this.props;return(0,P.tZ)(c.Z,{customComponent:(0,P.tZ)(ye,{children:(0,b.t)("Error loading widget data")}),children:(0,P.BX)(Ze,{isDragging:!1,children:[(0,P.BX)(Re,{children:[(0,P.tZ)(_e,{children:e.title}),this.renderContextMenu()]}),(0,P.tZ)(ge,{api:t,organization:o,widget:e,selection:s,children:({tableResults:t,timeseriesResults:d,errorMessage:l,loading:c})=>(0,P.BX)(r.Fragment,{children:["function"==typeof n?n(l):null,(0,P.tZ)(de,{timeseriesResults:d,tableResults:t,errorMessage:l,loading:c,location:a,widget:e,selection:s,router:i,organization:o}),this.renderToolbar()]})})]})})}}be.displayName="WidgetCard";const ve=(0,x.Z)((0,w.Z)((0,f.Z)((0,n.withRouter)(be)))),ye=(0,s.Z)(m.Z,{target:"emngp8q8"})("display:flex;align-items:center;justify-content:center;background-color:",(e=>e.theme.alert.error.backgroundLight),";border:1px solid ",(e=>e.theme.alert.error.border),";color:",(e=>e.theme.alert.error.textLight),";border-radius:",(e=>e.theme.borderRadius),";margin-bottom:",(0,y.Z)(2),";"),Ze=(0,s.Z)(h.s_,{shouldForwardProp:e=>"isDragging"!==e,target:"emngp8q7"})("margin:0;visibility:",(e=>e.isDragging?"hidden":"visible"),";height:100%;min-height:96px;"),xe=(0,s.Z)("div",{target:"emngp8q6"})("position:absolute;top:0;left:0;z-index:1;width:100%;height:100%;display:flex;justify-content:flex-end;align-items:flex-start;background-color:",(e=>e.theme.overlayBackgroundAlpha),";border-radius:",(e=>e.theme.borderRadius),";"),fe=(0,s.Z)("div",{target:"emngp8q5"})("display:flex;margin:10px ",(0,y.Z)(2),";touch-action:none;"),we=(0,s.Z)("div",{target:"emngp8q4"})("padding:",(0,y.Z)(1),";&:hover{cursor:pointer;}"),Ce=(0,s.Z)(g.LS,{target:"emngp8q3"})({name:"1fhyj3b",styles:"&:hover{cursor:grab;}"}),_e=(0,s.Z)(l.Gh,{target:"emngp8q2"})(v.Z,";"),Re=(0,s.Z)("div",{target:"emngp8q1"})("padding:",(0,y.Z)(2)," ",(0,y.Z)(3)," 0 ",(0,y.Z)(3),";width:100%;display:flex;justify-content:space-between;"),je=(0,s.Z)("div",{target:"emngp8q0"})("margin-left:",(0,y.Z)(1),";")}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_dashboards_tsx-app_views_dashboardsV2_widget_utils_tsx-app_views_dashboard-26458f.fa2851054ed9f496e07d329523d0a2a0.js.map