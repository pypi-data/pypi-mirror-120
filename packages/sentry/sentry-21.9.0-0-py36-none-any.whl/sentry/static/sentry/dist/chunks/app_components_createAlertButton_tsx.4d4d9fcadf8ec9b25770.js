"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["app_components_createAlertButton_tsx"],{"./app/components/createAlertButton.tsx":(e,t,r)=>{r.d(t,{K:()=>x,Z:()=>w});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),a=r("../node_modules/react-router/es/index.js"),i=r("./app/actionCreators/indicator.tsx"),s=r("./app/actionCreators/navigation.tsx"),c=r("./app/components/acl/access.tsx"),l=r("./app/components/alert.tsx"),u=r("./app/components/assistant/guideAnchor.tsx"),p=r("./app/components/button.tsx"),d=r("./app/components/links/link.tsx"),m=r("./app/icons/index.tsx"),y=r("./app/locale.tsx"),g=r("./app/utils/discover/fields.tsx"),h=r("./app/utils/withApi.tsx"),v=r("./app/views/alerts/incidentRules/constants.tsx"),f=r("./app/views/alerts/utils/index.tsx"),Z=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function b({incompatibleQuery:e,eventView:t,orgId:r,onClose:n}){const{hasProjectError:a,hasEnvironmentError:i,hasEventTypeError:s,hasYAxisError:c}=e,l=Object.values(e).filter((e=>!0===e)).length,u=t.clone();u.query+=" event.type:error";const p=t.clone();p.query+=" event.type:transaction";const g=t.clone();g.query+=" event.type:default";const h=t.clone();h.query+=" event.type:error or event.type:default";const v="/organizations/".concat(r,"/discover/results/"),f={error:(0,Z.tZ)(d.Z,{to:{pathname:v,query:u.generateQueryStringObject()}}),default:(0,Z.tZ)(d.Z,{to:{pathname:v,query:g.generateQueryStringObject()}}),transaction:(0,Z.tZ)(d.Z,{to:{pathname:v,query:p.generateQueryStringObject()}}),errorDefault:(0,Z.tZ)(d.Z,{to:{pathname:v,query:h.generateQueryStringObject()}})};return(0,Z.BX)(A,{type:"warning",icon:(0,Z.tZ)(m.aU,{color:"yellow300",size:"sm"}),children:[1===l&&(0,Z.BX)(o.Fragment,{children:[a&&(0,y.t)("An alert can use data from only one Project. Select one and try again."),i&&(0,y.t)("An alert supports data from a single Environment or All Environments. Pick one try again."),s&&(0,y._N)("An alert needs a filter of [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)]. Use one of these and try again.",f),c&&(0,y._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,Z.tZ)(z,{children:t.getYAxis()})})]}),l>1&&(0,Z.BX)(o.Fragment,{children:[(0,y.t)("Yikes! That button didn’t work. Please fix the following problems:"),(0,Z.BX)(k,{children:[a&&(0,Z.tZ)("li",{children:(0,y.t)("Select one Project.")}),i&&(0,Z.tZ)("li",{children:(0,y.t)("Select a single Environment or All Environments.")}),s&&(0,Z.tZ)("li",{children:(0,y._N)("Use the filter [error:event.type:error], [default:event.type:default], [transaction:event.type:transaction], [errorDefault:(event.type:error OR event.type:default)].",f)}),c&&(0,Z.tZ)("li",{children:(0,y._N)("An alert can’t use the metric [yAxis] just yet. Select another metric and try again.",{yAxis:(0,Z.tZ)(z,{children:t.getYAxis()})})})]})]}),(0,Z.tZ)(E,{icon:(0,Z.tZ)(m.bM,{color:"yellow300",size:"sm",isCircled:!0}),"aria-label":(0,y.t)("Close"),size:"zero",onClick:n,borderless:!0})]})}function x({projects:e,eventView:t,organization:r,referrer:n,onIncompatibleQuery:o,onSuccess:a,...i}){const s={hasProjectError:1!==t.project.length||-1===t.project[0],hasEnvironmentError:t.environment.length>1,hasEventTypeError:null===(0,f.A4)(t.query),hasYAxisError:function(e){var t;const r=(0,g.nr)(e.getYAxis());if("field"===r.kind||"equation"===r.kind)return!0;const n=e.query.match(/event\.type:(transaction|error)/);if(!n)return!1;const o="error"===n[1]?v.yq:v.Yp,a=!o.aggregations.includes(r.function[0]),i=g.lx[r.function[0]];if(!i)return!1;const s=i.parameters.some((e=>"value"===e.kind&&"number"===e.dataType)),c=["",...o.fields,...null!==(t=o.measurementKeys)&&void 0!==t?t:[]],l=!s&&!c.includes(r.function[1]);return a||l}(t)},c=e.find((e=>e.id==="".concat(t.project[0]))),l=Object.values(s).some((e=>e)),u=l?void 0:{pathname:"/organizations/".concat(r.slug,"/alerts/").concat(null==c?void 0:c.slug,"/new/"),query:{...t.generateQueryStringObject(),createFromDiscover:!0,referrer:n}};return(0,Z.tZ)(j,{organization:r,onClick:e=>{if(l)return e.preventDefault(),void o((e=>(0,Z.tZ)(b,{incompatibleQuery:s,eventView:t,orgId:r.slug,onClose:e})),s);a()},to:u,...i})}b.displayName="IncompatibleQueryAlert",x.displayName="CreateAlertFromViewButton";const j=(0,h.Z)((0,a.withRouter)((({organization:e,projectSlug:t,iconProps:r,referrer:n,router:o,hideIcon:a,api:l,showPermissionGuide:g,...h})=>{const v=t=>{const r="/organizations/".concat(e.slug,"/alerts/").concat(t);return"".concat(r,"/wizard/").concat(n?"?referrer=".concat(n):"")};function f(e){e.preventDefault(),(0,s.T)(v(":projectId"),o)}async function b(){const t="/organizations/".concat(e.slug,"/");(0,i.E3)();try{await l.requestPromise(t,{method:"PUT",data:{alertsMemberWrite:!0}}),(0,i.S9)((0,y.t)("Successfully updated organization settings"))}catch(e){(0,i.Iw)((0,y.t)("Unable to update organization settings"))}}const x=(0,y._N)("Ask your organization owner or manager to [settingsLink:enable alerts access] for you.",{settingsLink:(0,Z.tZ)(d.Z,{to:"/settings/".concat(e.slug)})}),j=e=>{var n;return(0,Z.tZ)(p.ZP,{disabled:!e,title:e?void 0:x,icon:!a&&(0,Z.tZ)(m.vr,{...r}),to:t?v(t):void 0,tooltipProps:{isHoverable:!0,position:"top",popperStyle:{maxWidth:"270px"}},onClick:t?void 0:f,...h,children:null!==(n=h.children)&&void 0!==n?n:(0,y.t)("Create Alert")})},w=!e.alertsMemberWrite&&!!g;return(0,Z.tZ)(c.Z,{organization:e,access:["alerts:write"],children:({hasAccess:t})=>w?(0,Z.tZ)(c.Z,{organization:e,access:["org:write"],children:({hasAccess:e})=>(0,Z.tZ)(u.Z,{target:e?"alerts_write_owner":"alerts_write_member",onFinish:e?b:void 0,children:j(t)})}):j(t)})}))),w=j,A=(0,n.Z)(l.Z,{target:"e173ycuj3"})("color:",(e=>e.theme.textColor),";margin-bottom:0;"),k=(0,n.Z)("ul",{target:"e173ycuj2"})({name:"1ykowef",styles:"margin-bottom:0"}),z=(0,n.Z)("code",{target:"e173ycuj1"})({name:"1imza1v",styles:"background-color:transparent;padding:0"}),E=(0,n.Z)(p.ZP,{target:"e173ycuj0"})({name:"1f7txv4",styles:"transition:opacity 0.1s linear;position:absolute;top:3px;right:0;&:hover,&:focus{background-color:transparent;opacity:1;}"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_createAlertButton_tsx.5dea69a3788f7b53aa0b9b9ec9b0ebf4.js.map