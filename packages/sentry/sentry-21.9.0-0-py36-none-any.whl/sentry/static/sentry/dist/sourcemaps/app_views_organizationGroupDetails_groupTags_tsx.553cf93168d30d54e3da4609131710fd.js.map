{"version":3,"file":"chunks/app_views_organizationGroupDetails_groupTags_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/deviceName.tsx","webpack:///./app/views/organizationGroupDetails/groupTags.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport {IOSDeviceList} from 'app/types/iOSDeviceList';\n\nexport function deviceNameMapper(model: string, iOSDeviceList): string {\n  const modelIdentifier = model.split(' ')[0];\n  const modelId = model.split(' ').splice(1).join(' ');\n  const modelName = iOSDeviceList.generationByIdentifier(modelIdentifier);\n  return modelName === undefined ? model : modelName + ' ' + modelId;\n}\n\nexport async function loadDeviceListModule() {\n  return import('ios-device-list');\n}\n\ntype Props = {\n  value: string;\n  children?: (name: string) => React.ReactNode;\n};\n\ntype State = {\n  iOSDeviceList: IOSDeviceList | null;\n};\n/**\n * This is used to map iOS Device Names to model name.\n * This asynchronously loads the ios-device-list library because of its size\n */\nexport default class DeviceName extends React.Component<Props, State> {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      iOSDeviceList: null,\n    };\n  }\n\n  componentDidMount() {\n    // This is to handle react's warning on calling setState for unmounted components\n    // Since we can't cancel promises, we need to do this\n    this._isMounted = true;\n\n    // This library is very big, so we are codesplitting it based on size and\n    // the relatively small utility this library provides\n    loadDeviceListModule().then(iOSDeviceList => {\n      if (!this._isMounted) {\n        return;\n      }\n\n      this.setState({iOSDeviceList});\n    });\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  private _isMounted?: boolean;\n\n  render() {\n    const {value, children} = this.props;\n    const {iOSDeviceList} = this.state;\n\n    // value can be undefined, need to return null or else react throws\n    if (!value) {\n      return null;\n    }\n\n    // If library has not loaded yet, then just render the raw model string, better than empty\n    if (!iOSDeviceList) {\n      return value;\n    }\n\n    const deviceName = deviceNameMapper(value, iOSDeviceList);\n\n    return (\n      <span data-test-id=\"loaded-device-name\">\n        {children ? children(deviceName) : deviceName}\n      </span>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from '@emotion/styled';\nimport isEqual from 'lodash/isEqual';\n\nimport {Client} from 'app/api';\nimport Alert from 'app/components/alert';\nimport Count from 'app/components/count';\nimport DeviceName from 'app/components/deviceName';\nimport GlobalSelectionLink from 'app/components/globalSelectionLink';\nimport LoadingError from 'app/components/loadingError';\nimport LoadingIndicator from 'app/components/loadingIndicator';\nimport {Panel, PanelBody, PanelHeader} from 'app/components/panels';\nimport Version from 'app/components/version';\nimport {t, tct} from 'app/locale';\nimport overflowEllipsis from 'app/styles/overflowEllipsis';\nimport space from 'app/styles/space';\nimport {Group, TagWithTopValues} from 'app/types';\nimport {percent} from 'app/utils';\nimport withApi from 'app/utils/withApi';\n\ntype Props = {\n  baseUrl: string;\n  group: Group;\n  api: Client;\n  environments: string[];\n};\n\ntype State = {\n  tagList: null | TagWithTopValues[];\n  loading: boolean;\n  error: boolean;\n};\n\nclass GroupTags extends React.Component<Props, State> {\n  state: State = {\n    tagList: null,\n    loading: true,\n    error: false,\n  };\n\n  componentDidMount() {\n    this.fetchData();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    if (!isEqual(prevProps.environments, this.props.environments)) {\n      this.fetchData();\n    }\n  }\n\n  fetchData = () => {\n    const {api, group, environments} = this.props;\n    this.setState({\n      loading: true,\n      error: false,\n    });\n\n    api.request(`/issues/${group.id}/tags/`, {\n      query: {environment: environments},\n      success: data => {\n        this.setState({\n          tagList: data,\n          error: false,\n          loading: false,\n        });\n      },\n      error: () => {\n        this.setState({\n          error: true,\n          loading: false,\n        });\n      },\n    });\n  };\n\n  getTagsDocsUrl() {\n    return 'https://docs.sentry.io/platform-redirect/?next=/enriching-events/tags';\n  }\n\n  render() {\n    const {baseUrl} = this.props;\n\n    let children: React.ReactNode[] = [];\n\n    if (this.state.loading) {\n      return <LoadingIndicator />;\n    } else if (this.state.error) {\n      return <LoadingError onRetry={this.fetchData} />;\n    }\n\n    if (this.state.tagList) {\n      children = this.state.tagList.map((tag, tagIdx) => {\n        const valueChildren = tag.topValues.map((tagValue, tagValueIdx) => {\n          let label: React.ReactNode = null;\n          const pct = percent(tagValue.count, tag.totalValues);\n          const query = tagValue.query || `${tag.key}:\"${tagValue.value}\"`;\n\n          switch (tag.key) {\n            case 'release':\n              label = <Version version={tagValue.name} anchor={false} />;\n              break;\n            default:\n              label = <DeviceName value={tagValue.name} />;\n          }\n\n          return (\n            <li key={tagValueIdx} data-test-id={tag.key}>\n              <TagBarGlobalSelectionLink\n                to={{\n                  pathname: `${baseUrl}events/`,\n                  query: {query},\n                }}\n              >\n                <TagBarBackground style={{width: pct + '%'}} />\n                <TagBarLabel>{label}</TagBarLabel>\n                <TagBarCount>\n                  <Count value={tagValue.count} />\n                </TagBarCount>\n              </TagBarGlobalSelectionLink>\n            </li>\n          );\n        });\n\n        return (\n          <TagItem key={tagIdx}>\n            <Panel>\n              <PanelHeader hasButtons style={{textTransform: 'none'}}>\n                <div style={{fontSize: 16}}>{tag.key}</div>\n                <DetailsLinkWrapper>\n                  <GlobalSelectionLink\n                    className=\"btn btn-default btn-sm\"\n                    to={`${baseUrl}tags/${tag.key}/`}\n                  >\n                    {t('More Details')}\n                  </GlobalSelectionLink>\n                </DetailsLinkWrapper>\n              </PanelHeader>\n              <PanelBody withPadding>\n                <ul style={{listStyleType: 'none', padding: 0, margin: 0}}>\n                  {valueChildren}\n                </ul>\n              </PanelBody>\n            </Panel>\n          </TagItem>\n        );\n      });\n    }\n\n    return (\n      <div>\n        <Container>{children}</Container>\n        <Alert type=\"info\">\n          {tct(\n            'Tags are automatically indexed for searching and breakdown charts. Learn how to [link: add custom tags to issues]',\n            {\n              link: <a href={this.getTagsDocsUrl()} />,\n            }\n          )}\n        </Alert>\n      </div>\n    );\n  }\n}\n\nconst DetailsLinkWrapper = styled('div')`\n  display: flex;\n`;\n\nconst Container = styled('div')`\n  display: flex;\n  flex-wrap: wrap;\n`;\n\nconst TagItem = styled('div')`\n  padding: 0 ${space(1)};\n  width: 50%;\n`;\n\nconst TagBarBackground = styled('div')`\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  background: ${p => p.theme.tagBar};\n  border-radius: ${p => p.theme.borderRadius};\n`;\n\nconst TagBarGlobalSelectionLink = styled(GlobalSelectionLink)`\n  position: relative;\n  display: flex;\n  line-height: 2.2;\n  color: ${p => p.theme.textColor};\n  margin-bottom: ${space(0.5)};\n  padding: 0 ${space(1)};\n  background: ${p => p.theme.backgroundSecondary};\n  border-radius: ${p => p.theme.borderRadius};\n  overflow: hidden;\n\n  &:hover {\n    color: ${p => p.theme.textColor};\n    text-decoration: underline;\n    ${TagBarBackground} {\n      background: ${p => p.theme.tagBarHover};\n    }\n  }\n`;\n\nconst TagBarLabel = styled('div')`\n  position: relative;\n  flex-grow: 1;\n  ${overflowEllipsis}\n`;\n\nconst TagBarCount = styled('div')`\n  position: relative;\n  padding-left: ${space(2)};\n`;\n\nexport default withApi(GroupTags);\n"],"names":["deviceNameMapper","model","iOSDeviceList","modelIdentifier","split","modelId","splice","join","modelName","generationByIdentifier","undefined","async","loadDeviceListModule","DeviceName","React","constructor","props","super","this","state","componentDidMount","_isMounted","then","setState","componentWillUnmount","render","value","children","deviceName","GroupTags","tagList","loading","error","api","group","environments","request","id","query","environment","success","data","fetchData","componentDidUpdate","prevProps","isEqual","getTagsDocsUrl","baseUrl","onRetry","map","tag","tagIdx","valueChildren","topValues","tagValue","tagValueIdx","label","pct","percent","count","totalValues","key","version","name","anchor","TagBarGlobalSelectionLink","to","pathname","TagBarBackground","style","width","TagBarLabel","TagBarCount","TagItem","hasButtons","textTransform","fontSize","DetailsLinkWrapper","className","t","withPadding","listStyleType","padding","margin","Container","type","tct","link","href","space","p","theme","tagBar","borderRadius","GlobalSelectionLink","textColor","backgroundSecondary","tagBarHover","overflowEllipsis","withApi"],"sourceRoot":""}