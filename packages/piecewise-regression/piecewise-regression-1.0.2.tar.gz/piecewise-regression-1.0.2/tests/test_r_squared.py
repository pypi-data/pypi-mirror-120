import copy

import pandas as pd
import numpy as np
import unittest

import os, sys
sys.path.insert(1, os.path.join(sys.path[0], '..'))

import piecewise_regression.r_squared_calc as r_squared_calc

class TestRSquared(unittest.TestCase):

    def test_some_data(self):

        ff = np.linspace(0,10)
        yy = np.linspace(0,10)

        rss, tss, r_2, adjusted_r_2 = r_squared_calc.get_r_squared(yy, ff, 1)

        self.assertEqual(r_2, 1)
        self.assertEqual(adjusted_r_2, 1)

        ff = [0.1, 0.8, 0.4, -4, 6, 12, 14, 1]
        yy = [1, 2, 3, 4, 5, 6, 6, 6]

        rss, tss, r_2, adjusted_r_2 = r_squared_calc.get_r_squared(yy, ff, 1)

        # Value calculated from sklearn's r2_score function
        r_2_from_sklearn = -6.405023255813953
        self.assertEqual(r_2_from_sklearn, r_2)

        # Test with data from bp fit
        ff = np.array([100.6466801609725, 100.22604536744389, 99.80541057391528, 99.38477578038668, 98.96414098685806, 98.54350619332945, 98.12287139980084, 97.70223660627224, 97.28160181274363, 96.86096701921502, 96.44033222568642, 96.01969743215781, 95.59906263862919, 95.17842784510059, 94.75779305157198, 94.33715825804337, 93.91652346451477, 93.49588867098616, 93.07525387745756, 92.65461908392894, 92.23398429040033, 91.81334949687172, 91.39271470334312, 90.97207990981451, 90.5514451162859, 90.1308103227573, 89.71017552922868, 89.28954073570007, 88.86890594217147, 88.44827114864286, 88.02763635511425, 87.60700156158565, 87.18636676805704, 86.76573197452842, 86.34509718099982, 85.92446238747121, 85.5038275939426, 85.083192800414, 84.66255800688539, 84.24192321335678, 83.82128841982816, 83.40065362629957, 82.98001883277095, 82.55938403924235, 82.13874924571374, 81.71811445218513, 81.29747965865653, 80.87684486512791, 80.45621007159932, 80.0355752780707, 79.61494048454209, 79.19430569101348, 78.77367089748488, 78.35303610395627, 77.93240131042766, 77.51176651689906, 77.09113172337044, 76.67049692984183, 76.24986213631323, 75.82922734278462, 75.40859254925601, 74.98795775572741, 74.5673229621988, 74.14668816867018, 73.72605337514159, 73.30541858161297, 72.88478378808436, 72.46414899455576, 72.04351420102715, 71.62287940749854, 71.20224461396992, 70.78160982044133, 70.04396951676658, 69.25506553978708, 68.46616156280757, 67.67725758582806, 66.88835360884856, 66.09944963186904, 65.31054565488954, 64.52164167791003, 63.73273770093051, 62.943833723951, 62.15492974697149, 61.366025769991985, 60.577121793012466, 59.78821781603297, 58.99931383905345, 58.210409862073945, 57.42150588509443, 56.63260190811493, 55.84369793113541, 55.054793954155905, 54.2658899771764, 53.47698600019689, 52.688082023217376, 51.899178046237864, 51.11027406925836, 50.321370092278855, 49.532466115299336, 48.74356213831983, 47.95465816134032, 47.165754184360814, 46.3768502073813, 45.5879462304018, 44.799042253422286, 44.01013827644278, 43.22123429946326, 42.43233032248376, 41.64342634550425, 40.854522368524734, 40.06561839154523, 39.27671441456572, 38.48781043758621, 37.6989064606067, 36.91000248362719, 36.121098506647684, 35.33219452966817, 34.54329055268866, 33.75438657570915, 32.96548259872965, 32.17657862175014, 31.387674644770623, 30.956397705609703, 30.551312979085758, 30.14622825256181, 29.741143526037856, 29.336058799513907, 28.93097407298996, 28.525889346466013, 28.120804619942056, 27.71571989341811, 27.310635166894166, 26.90555044037021, 26.50046571384626, 26.095380987322315, 25.690296260798366, 25.285211534274413, 24.880126807750464, 24.47504208122652, 24.06995735470257, 23.664872628178617, 23.25978790165467, 22.854703175130723, 22.44961844860677, 22.04453372208282, 21.639448995558872, 21.234364269034927, 20.829279542510974, 20.424194815987025, 20.019110089463076, 19.61402536293913, 19.20894063641518, 18.803855909891226, 18.398771183367288, 17.993686456843324, 17.588601730319375, 17.18351700379543, 16.778432277271484, 16.373347550747535, 15.968262824223588, 15.563178097699629, 15.158093371175678, 14.753008644651732, 14.347923918127787, 13.942839191603834, 13.537754465079892, 13.132669738555926, 12.727585012031994, 12.322500285508035, 11.917415558984086, 11.51233083246014, 11.107246105936188, 10.702161379412242, 10.2970766528883, 9.891991926364334, 9.486907199840402, 9.081822473316443, 8.676737746792494, 8.271653020268548, 7.866568293744596, 7.461483567220636, 7.056398840696705, 6.651314114172742, 6.24622938764881, 5.841144661124851, 5.436059934600898, 5.030975208076953, 4.625890481553004, 4.220805755029044, 3.815721028505113, 3.410636301981146, 3.0055515754572184, 2.6004668489332587, 2.195382122409306, 1.7902973958853607, 1.3852126693614117, 0.9801279428374521, 0.5750432163135208, 0.16995848978955408, -0.23512623673438782])
        yy = np.array([101.76405234596767, 99.99814715811596, 100.17471788360322, 101.03486304844768, 100.25951778914494, 97.0126718688673, 98.53802811601805, 97.0345724399435, 96.6807007461964, 96.79250804967705, 96.12394306864832, 97.03216295419915, 95.93691712213192, 94.89554436322649, 94.81572252922784, 94.30352357360542, 95.06191826913751, 92.96067088196284, 93.0768867971283, 91.5077133059244, 89.4068091791408, 92.21140754016398, 92.02021509333187, 90.01160382381465, 92.62151341795746, 88.49538306911982, 89.59349721076879, 88.95854479319024, 90.27649780732328, 89.81106731261384, 88.09464591815923, 87.91585096181322, 86.24789264432968, 84.75287187348461, 85.98374614213114, 86.08599721031, 86.7579288716825, 86.32800798948793, 84.33629127304431, 84.01930528962566, 82.87104502488266, 82.09757000251952, 81.40930769882223, 84.66434323442776, 81.80190560719308, 81.47147343708228, 80.25474232839228, 81.88301799402286, 79.08961974038175, 80.08876725747447, 79.00403092624352, 79.88438993504519, 78.58467224936581, 77.512835152561, 78.26327505809351, 78.31777910671131, 77.55395440831282, 77.38789903341817, 76.04909499174617, 75.91866586918874, 75.20693653714868, 75.11783377313282, 74.26223060237766, 72.94708423183917, 74.44878292617335, 73.46756579746007, 71.83713833645105, 73.5281088886916, 71.75601821853134, 72.31325192845945, 72.44768352700166, 71.04355577507901, 71.2499534483624, 68.07170684296293, 68.90485420399162, 67.01368237137123, 66.02367521262717, 65.5116025965421, 64.97487962867665, 64.53857740253125, 62.513242119015636, 63.77519834625066, 62.53601419852441, 59.730087972014225, 61.950563751584546, 61.55418063331701, 60.033050927943556, 57.87032642046905, 56.17547853426835, 57.49666278220751, 55.23501400780068, 56.05661592465378, 54.238425731845695, 54.202769689750035, 52.77847694993822, 52.32466362045325, 50.824570372479606, 51.79592074516211, 49.33294224345738, 48.80399941369595, 49.48114064680499, 45.44621078810378, 44.71946475025798, 46.15532635639921, 43.208786142624525, 45.521510632885466, 42.36025036597391, 41.22239443479039, 43.08877117220902, 41.84232383666055, 41.42534790515018, 39.65981350249648, 37.08852305866388, 39.055793596315105, 36.07370517176218, 36.34014483800745, 35.68092030948228, 33.77463814811519, 33.739707511049595, 33.24381471176753, 32.135219501004876, 30.257383129013792, 31.253012043552786, 31.879149715782503, 29.456185909112854, 29.59910917826529, 28.91158011662007, 30.793987346569793, 29.215008324851627, 28.54816535382905, 26.968777392891365, 27.87593260837724, 26.26034070617679, 26.564493874857263, 25.494807187952777, 26.4050765110269, 25.903223982444086, 24.71632435999989, 24.918619777988276, 23.027541506344868, 22.227335372118514, 23.7559746158374, 23.081246359694134, 23.147594250962456, 24.493697538683037, 22.65302220055825, 20.39371043787242, 22.02153890116118, 19.186605152302548, 19.6389179077481, 19.630250856986926, 21.009825133709665, 18.149717539760605, 17.66602377289877, 17.991999736881098, 17.024963924693168, 18.413068082910527, 15.80449060218934, 15.334943407890403, 15.642581965305816, 15.180359509106681, 17.205913963364722, 15.823792666222236, 14.559913050430415, 12.844916239963794, 14.512704684944259, 12.266116310901884, 11.319550511262587, 13.650341350141238, 12.377244119462537, 12.579150281067243, 11.575009059978196, 11.711101968686602, 9.801235713232515, 9.016008414496934, 10.329835724311778, 8.442821491605045, 8.154671327777438, 7.986678551759031, 8.057680164050181, 7.284197043520377, 5.861229611104593, 6.1905524514384584, 4.208757651795674, 6.655382204796024, 4.02608304791084, 4.121747313837874, 4.876285682276049, 3.6825475563724983, 5.563115097919298, 2.3252335425378505, 3.483131271359233, 2.774787533531291, 1.24396680376634, 2.533326911788028, 1.436493869782777, 1.977820701967429, 1.6275242544662438, 2.565245999531939, 1.336527949436392])

        rss, tss, r_2, adjusted_r_2 = r_squared_calc.get_r_squared(yy, ff, 6)
        # Value calculated from sklearn's r2_score function
        r_2_from_sklearn = 0.9990626123719015
        self.assertEqual(r_2_from_sklearn, r_2)




if __name__ == '__main__':
    unittest.main()

#sklearn.metrics.r2_score(y_true, y_pred

